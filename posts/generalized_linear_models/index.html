<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Generalized Linear Models | Tai's Blog</title><meta name=keywords content="linear models"><meta name=description content="å®šä¹‰ è‹¥ä¸€ä¸ªåˆ†å¸ƒèƒ½å¤Ÿä»¥ä¸‹è¿°æ–¹å¼è¿›è¡Œè¡¨ç¤ºï¼Œåˆ™ç§°ä¹‹ä¸ºæŒ‡æ•°æ—ï¼ˆ Exponential Familyï¼‰çš„ä¸€å‘˜ $$ \begin{equation} p(y; \eta ) = b(y)\exp(\eta^{\mathbf{T}}T(y) - a(\eta )) \end{equation} $$ å…¶ä¸­$\eta$è¢«ç§°ä¸ºåˆ†å¸ƒçš„è‡ªç„¶å‚æ•°ï¼ˆn"><meta name=author content><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="eAKh7zszsOtNde1wyq_sUo95ZPH4zTTJhR-_ol4VWDs"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://yunpengtai.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://yunpengtai.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://yunpengtai.top/favicon-32x32.png><link rel=apple-touch-icon href=http://yunpengtai.top/apple-touch-icon.png><link rel=mask-icon href=http://yunpengtai.top/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>MathJax={loader:{load:["[tex]/boldsymbol"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"all",packages:{"[+]":["boldsymbol"]}}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml-full.js integrity="sha256-kbAFUDxdHwlYv01zraGjvjNZayxKtdoiJ38bDTFJtaQ=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3CX2RWEDY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y3CX2RWEDY",{anonymize_ip:!1})}</script><meta property="og:title" content="Generalized Linear Models"><meta property="og:description" content="å®šä¹‰ è‹¥ä¸€ä¸ªåˆ†å¸ƒèƒ½å¤Ÿä»¥ä¸‹è¿°æ–¹å¼è¿›è¡Œè¡¨ç¤ºï¼Œåˆ™ç§°ä¹‹ä¸ºæŒ‡æ•°æ—ï¼ˆ Exponential Familyï¼‰çš„ä¸€å‘˜ $$ \begin{equation} p(y; \eta ) = b(y)\exp(\eta^{\mathbf{T}}T(y) - a(\eta )) \end{equation} $$ å…¶ä¸­$\eta$è¢«ç§°ä¸ºåˆ†å¸ƒçš„è‡ªç„¶å‚æ•°ï¼ˆn"><meta property="og:type" content="article"><meta property="og:url" content="http://yunpengtai.top/posts/generalized_linear_models/"><meta property="og:image" content="http://yunpengtai.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-17T14:10:00+08:00"><meta property="article:modified_time" content="2023-02-17T14:10:00+08:00"><meta property="og:site_name" content="Tai's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://yunpengtai.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Generalized Linear Models"><meta name=twitter:description content="å®šä¹‰ è‹¥ä¸€ä¸ªåˆ†å¸ƒèƒ½å¤Ÿä»¥ä¸‹è¿°æ–¹å¼è¿›è¡Œè¡¨ç¤ºï¼Œåˆ™ç§°ä¹‹ä¸ºæŒ‡æ•°æ—ï¼ˆ Exponential Familyï¼‰çš„ä¸€å‘˜ $$ \begin{equation} p(y; \eta ) = b(y)\exp(\eta^{\mathbf{T}}T(y) - a(\eta )) \end{equation} $$ å…¶ä¸­$\eta$è¢«ç§°ä¸ºåˆ†å¸ƒçš„è‡ªç„¶å‚æ•°ï¼ˆn"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"http://yunpengtai.top/posts/"},{"@type":"ListItem","position":3,"name":"Generalized Linear Models","item":"http://yunpengtai.top/posts/generalized_linear_models/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Generalized Linear Models","name":"Generalized Linear Models","description":"å®šä¹‰ è‹¥ä¸€ä¸ªåˆ†å¸ƒèƒ½å¤Ÿä»¥ä¸‹è¿°æ–¹å¼è¿›è¡Œè¡¨ç¤ºï¼Œåˆ™ç§°ä¹‹ä¸ºæŒ‡æ•°æ—ï¼ˆ Exponential Familyï¼‰çš„ä¸€å‘˜ $$ \\begin{equation} p(y; \\eta ) = b(y)\\exp(\\eta^{\\mathbf{T}}T(y) - a(\\eta )) \\end{equation} $$ å…¶ä¸­$\\eta$è¢«ç§°ä¸ºåˆ†å¸ƒçš„è‡ªç„¶å‚æ•°ï¼ˆn","keywords":["linear models"],"articleBody":"å®šä¹‰ è‹¥ä¸€ä¸ªåˆ†å¸ƒèƒ½å¤Ÿä»¥ä¸‹è¿°æ–¹å¼è¿›è¡Œè¡¨ç¤ºï¼Œåˆ™ç§°ä¹‹ä¸ºæŒ‡æ•°æ—ï¼ˆ Exponential Familyï¼‰çš„ä¸€å‘˜\n$$ \\begin{equation} p(y; \\eta ) = b(y)\\exp(\\eta^{\\mathbf{T}}T(y) - a(\\eta )) \\end{equation} $$ å…¶ä¸­$\\eta$è¢«ç§°ä¸ºåˆ†å¸ƒçš„è‡ªç„¶å‚æ•°ï¼ˆnatural parameterï¼‰æˆ–æ ‡å‡†å‚æ•°ï¼ˆcanonical parameterï¼‰ï¼›è€Œ$T(y)$è¢«ç§°ä¸ºç»Ÿè®¡å……åˆ†é‡ï¼ˆsufficient statisticï¼‰ï¼Œé€šå¸¸è€Œè¨€ï¼š$T(y) = y$ï¼›$a(\\eta)$æ˜¯å¯¹æ•°é…åˆ†å‡½æ•°ï¼ˆlog partitionï¼‰\nä¾‹å­ æ¥ä¸‹æ¥å±•ç¤ºä¸‹ä¼¯åŠªåˆ©åˆ†å¸ƒå’Œé«˜æ–¯åˆ†å¸ƒéƒ½æ˜¯æŒ‡æ•°æ—çš„ä¸€å‘˜\næœŸæœ›ä¸º$\\phi$çš„ä¼¯åŠªåˆ©åˆ†å¸ƒä¸”$y \\in \\{1, 0\\}$ï¼Œé‚£ä¹ˆï¼š\n$$ p(y=1) = \\phi; p(y=0) = 1-\\phi $$\næ¥ç€è¿›è¡Œè½¬æ¢ï¼š\n$$ \\begin{align} p(y;\\phi ) \u0026 = \\phi^{y}(1-\\phi )^{1-y} \\\\ \u0026= \\exp \\bigg(\\log(\\phi^{y}(1-\\phi )^{1-y})\\bigg) \\\\ \u0026= \\exp(y\\log \\phi + (1-y)\\log(1-\\phi )) \\\\ \u0026= \\exp\\left( \\left( \\log \\frac{\\phi }{1-\\phi } \\right)y + \\log(1-\\phi) \\right) \\end{align} $$\né‚£ä¹ˆå¯ä»¥å¯¹æ¯”ç€æŒ‡æ•°æ—çš„å®šä¹‰ï¼Œæ˜“å¾—$b(y)=1$ä»¥åŠï¼š\n$$ \\begin{align} \\eta \u0026 = \\log\\left( \\frac{\\phi }{1-\\phi } \\right) \\\\ e^{\\eta } \u0026 = \\frac{\\phi}{1-\\phi } \\\\ {\\color{red}e^{-\\eta }} \u0026 = \\frac{1-\\phi}{\\phi } = \\frac{1}{\\phi } - 1 \\\\ \\phi \u0026 = \\frac{1}{1+e^{-\\eta }} \\end{align} $$\nå‘ç°å¾ˆæœ‰è¶£çš„ä¸€ç‚¹ï¼Œ$\\phi(\\eta)$ä¸å°±æ˜¯é€»è¾‘å›å½’ä¸­çš„sigmoidå‡½æ•°å˜›ï¼Œç»§ç»­æ¯”å¯¹å°†å…¶ä»–çš„å‚æ•°å†™å®Œæ•´ï¼š\n$$ \\begin{align} a(\\eta ) \u0026 = -\\log(1-\\phi ) = -\\log\\left( 1-\\frac{1}{1+e^{-\\eta }} \\right) \\\\ \u0026= \\log (1+e^{\\eta }) \\end{align} $$\næ¥ä¸‹æ¥è®¨è®ºé«˜æ–¯åˆ†å¸ƒï¼Œ$\\sigma^{2}$å¯¹$\\theta, h_{\\theta }(x)$æ˜¯ä¸å½±å“çš„ï¼ˆç›¸å½“äºå¸¸æ•°ï¼‰ï¼Œä¸ºäº†ç®€åŒ–è¡¨ç¤ºï¼Œçº¦å®š$\\sigma^{2}=1$\n$$ \\begin{align} p(y;\\mu ) \u0026 = \\frac{1}{\\sqrt{ 2\\pi }}\\exp\\left( -\\frac{(y-\\mu )^{2}}{2} \\right) \\\\ \u0026= \\underbrace{ \\frac{1}{\\sqrt{ 2\\pi }} \\exp\\left( -\\frac{y^{2}}{2} \\right) }_{ b(y) }\\exp\\left( \\mu y - \\frac{\\mu^{2}}{2} \\right) \\end{align} $$\næ¯”å¯¹å®šä¹‰ï¼Œå¯ä»¥å‘ç°ï¼š\n$$ \\eta = \\mu; a(\\eta ) = -\\frac{\\eta^{2}}{2} $$\næ€§è´¨ $$ p(y;\\eta ) = b(y)\\exp (\\eta^{\\mathbf{T}}T(y) - a(\\eta)) $$\næŒ‡æ•°æ—åˆ†å¸ƒçš„æœŸæœ›æ˜¯$a(\\eta)$å¯¹$\\eta$çš„ä¸€é˜¶å¾®åˆ† æŒ‡æ•°æ—åˆ†å¸ƒçš„æ–¹å·®æ˜¯$a(\\eta)$å¯¹$\\eta$çš„äºŒé˜¶å¾®åˆ† æŒ‡æ•°æ—åˆ†å¸ƒçš„NLL lossæ˜¯concaveçš„ ä¸‹é¢æ¥è¯æ˜ä¸Šè¿°è§‚ç‚¹ï¼š\n$$ \\begin{align} \\frac{ \\partial }{ \\partial \\eta } p(y;\\eta ) \u0026 = b(y) \\exp(\\eta^{\\mathbf{T}}y - a(\\eta )) \\left( y - \\frac{ \\partial }{ \\partial \\eta }a(\\eta ) \\right) \\\\ \u0026= yp(y;\\eta ) - p(y;\\eta ) \\frac{ \\partial }{ \\partial \\eta } a(\\eta ) \\end{align} $$\né‚£ä¹ˆï¼š\n$$ y p(y;\\eta ) = \\frac{ \\partial }{ \\partial \\eta } p(y;\\eta ) + p(y;\\eta ) \\frac{ \\partial }{ \\partial \\eta } a(\\eta ) $$\nåˆå› ä¸ºï¼š\n$$ \\begin{align} \\mathbb{E}[Y;\\eta ] \u0026 = \\mathbb{E}[Y|X;\\eta] \\\\ \u0026= \\int yp(y;\\eta ) \\,dy \\\\ \u0026= \\int \\frac{ \\partial }{ \\partial \\eta } p(y;\\eta ) + p(y;\\eta )\\frac{ \\partial }{ \\partial \\eta }a(\\eta ) \\, dy \\\\ \u0026= \\int \\frac{ \\partial }{ \\partial \\eta }p(y;\\eta ) \\, dy + \\int p(y;\\eta )\\frac{ \\partial }{ \\partial \\eta }a(\\eta ) \\, dy \\\\ \u0026= \\frac{ \\partial }{ \\partial \\eta } \\int p(y;\\eta ) \\, dy + \\frac{ \\partial }{ \\partial \\eta }a(\\eta ) \\int p(y;\\eta ) \\, dy \\\\ \u0026= \\frac{ \\partial }{ \\partial \\eta } \\cdot 1 + \\frac{ \\partial }{ \\partial \\eta } a(\\eta ) \\cdot 1 \\\\ \u0026= 0 + \\frac{ \\partial }{ \\partial \\eta } a(\\eta ) \\\\ \u0026= \\frac{ \\partial }{ \\partial \\eta } a(\\eta) \\quad \\blacksquare \\end{align} $$\nä¸‹é¢æ¥è¯æ˜æ–¹å·®ï¼š\n$$ \\begin{align} \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } p(y;\\eta ) \u0026 = \\frac{ \\partial }{ \\partial \\eta } \\bigg(yp(y;\\eta ) - p(y;\\eta ) \\frac{ \\partial }{ \\partial \\eta } a(\\eta )\\bigg) \\\\ \u0026= y\\frac{ \\partial }{ \\partial \\eta }p(y;\\eta ) - \\frac{ \\partial }{ \\partial \\eta } a(\\eta )\\frac{ \\partial }{ \\partial \\eta }p(y;\\eta ) - p(y;\\eta )\\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta) \\\\ \u0026= \\frac{ \\partial }{ \\partial \\eta }p(y;\\eta ) \\bigg(y - \\frac{ \\partial }{ \\partial \\eta }a(\\eta ) \\bigg) - p(y;\\eta )\\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta ) \\\\ \u0026= \\bigg(yp(y;\\eta ) - p(y;\\eta ) \\frac{ \\partial }{ \\partial \\eta } a(\\eta )\\bigg)\\bigg(y- \\frac{ \\partial }{ \\partial \\eta }a(\\eta ) \\bigg) - p(y;\\eta ) \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta ) \\\\ \u0026= y^{2}p(y;\\eta ) - 2yp(y;\\eta ) \\frac{ \\partial }{ \\partial \\eta }a(\\eta ) + p(y;\\eta ) (\\frac{ \\partial }{ \\partial \\eta }a(\\eta ) )^{2} - p(y;\\eta ) \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta ) \\\\ \u0026= \\bigg(y - \\frac{ \\partial }{ \\partial \\eta }a(\\eta) \\bigg)^{2} p(y;\\eta ) -p(y;\\eta ) \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta) \\end{align} $$\né‚£ä¹ˆï¼š\n$$ \\bigg(y - \\frac{ \\partial }{ \\partial \\eta }a(\\eta) \\bigg)^{2} p(y;\\eta ) = \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } p(y;\\eta ) +p(y;\\eta ) \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta) $$\nåˆå› ä¸ºï¼š\n$$ \\begin{align} \\mathbb{V}[Y;\\eta ] \u0026 = \\mathbb{V}[Y|X;\\eta] \\\\ \u0026= \\int \\left( y - \\frac{ \\partial }{ \\partial \\eta } a(\\eta ) \\right)^{2} p(y;\\eta)\\, dy \\\\ \u0026= \\int \\frac{ \\partial^{2} }{ \\partial \\eta^{2} }p(y;\\eta) + p(y;\\eta ) \\frac{ \\partial^{2} }{ \\partial \\eta^{2} }a(\\eta ) \\, dy \\\\ \u0026= \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } \\int p(y;\\eta ) \\, dy + \\frac{ \\partial ^{2} }{ \\partial \\eta^{2} } a(\\eta )\\int p(y;\\eta ) \\, dy \\\\ \u0026= 0 + \\frac{ \\partial ^{2} }{ \\partial \\eta^{2} } a(\\eta ) \\\\ \u0026= \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta ) \\quad \\blacksquare \\end{align} $$\næ¥ä¸‹æ¥è¯æ˜NLL Lossæ˜¯å‡¸å‡½æ•°ï¼Œå…¶ä¸­$a(\\eta) \\in \\mathbb{R}^{m}, \\mathbf{y} \\in \\mathbb{R}^{m}$ï¼š\n$$ \\begin{align} J(\\eta) \u0026 = -\\log \\sum_{i}^{m} p(y^{(i)};\\eta_{i} ) \\\\ \u0026= -\\log \\sum_{i}^{m} b(y^{(i)})\\exp(\\eta_{i} T(y^{(i)}) - a(\\eta_{i})) \\\\ \u0026= -\\log \\sum_{i}^{m} b(y^{(i)}) \\exp( \\eta_{i} y^{(i)}- a(\\eta_{i})) \\\\ \u0026= a(\\eta) -\\sum_{i}^{m} \\log b(y^{(i)}) + \\eta_{i}y^{(i)} \\end{align} $$ åŒæ—¶å› ä¸ºè‡ªèº«çš„åæ–¹å·®çŸ©é˜µæ˜¯ã€ŒåŠæ­£å®šã€çš„ï¼š\n$$ \\begin{align} \\nabla_{\\eta }^{2} J(\\eta ) = \\frac{ \\partial^{2} }{ \\partial \\eta^{2} } a(\\eta ) = \\mathbb{V}[\\mathbf{y};\\eta ] \\implies PSD\\quad \\blacksquare \\end{align} $$\nç”±[[Critical Points#å¤šå˜é‡]]å¯çŸ¥ï¼Œå½“HessiançŸ©é˜µæ˜¯åŠæ­£å®šæ—¶ï¼ŒNLL Lossæ˜¯å‡¸å‡½æ•°ï¼Œæœ‰å±€éƒ¨æœ€å°ç‚¹\næ„å»ºGLM åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ ¹æ®æˆ‘ä»¬éœ€è¦é¢„æµ‹çš„å˜é‡æ¥é€‰å–åˆé€‚çš„åˆ†å¸ƒï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•æ„å»ºæ¨¡å‹å»é¢„æµ‹å®ƒå‘¢ï¼Ÿè¿™é‡Œæ¨¡å‹åˆè¢«ç§°ä¸ºå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼ˆGeneralized Linear Modelï¼‰ï¼Œè¦æ„å»ºGLMï¼Œéœ€è¦å…ˆè¿›è¡Œä¸€äº›å‡è®¾ï¼š\n$y|x; \\theta \\sim \\mathrm{ExponentialFamily}(\\eta )$ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»™å®š$x, \\theta$ æˆ‘ä»¬å¯ä»¥å¾—åˆ°$y$çš„åˆ†å¸ƒå°±æ˜¯å¸¦æœ‰å‚æ•°$\\eta$çš„æŒ‡æ•°æ—åˆ†å¸ƒ ç»™å®š$x$ï¼Œæˆ‘ä»¬éœ€è¦å»é¢„æµ‹$y$ï¼Œåœ¨æŒ‡æ•°æ—ä¸­ï¼Œ$y=T(y)$ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¾—å»é¢„æµ‹æœŸæœ›ï¼Œå³å­¦å¾—çš„å‡è®¾$h$éœ€è¦å»é¢„æµ‹æœŸæœ›ï¼Œå³ï¼š$h(x) = \\mathbb{E}[y|x]$ï¼Œè¿™ä¸ªåœ¨çº¿æ€§å›å½’å’Œé€»è¾‘å›å½’éƒ½æ˜¯æ»¡è¶³çš„ï¼Œä¸¾ä¸ªé€»è¾‘å›å½’çš„ä¾‹å­ï¼š $$ h_{\\theta }(x) = p(y=1|x;\\theta ) = 0 \\cdot p(y=0|x;\\theta) + 1 \\cdot p(y=1|x;\\theta) = \\mathbb{E}[y|x;\\theta ] $$ è‡ªç„¶å‚æ•°$\\eta$ä¸$x$çš„è”ç³»æ˜¯çº¿æ€§çš„ï¼Œå³$\\eta = \\theta^{\\mathbf{T}}x$ï¼Œè‹¥$\\eta \\in \\mathbb{R}^{n}$ï¼Œåˆ™$\\eta_{i} = \\theta_{i}^{\\mathbf{T}}{x}$ æ ¹æ®å˜é‡çš„ç‰¹ç‚¹æ¥é€‰æ‹©åˆé€‚çš„åˆ†å¸ƒï¼š\nVariable Distribution Real Numbers $\\mathbb{R}$ Gaussian Binary Classification Bernoulli Count Poisson $\\mathbb{R}^{+}$ Gamma, Exponential Distribution Beta, Dirichlet GLMä¾‹å­ æ¥ä¸‹æ¥ä¸¾ä¸€äº›GLMçš„ä¾‹å­\nOLS Ordinary Least Squaresï¼ˆçº¿æ€§å›å½’ï¼‰ä¸­çš„$y|x;\\theta \\sim \\mathcal{N}(\\mu, \\sigma^{2})$ï¼Œå³æœä»é«˜æ–¯åˆ†å¸ƒï¼Œå…¶ä¸­$\\eta = \\mu$ï¼Œé‚£ä¹ˆï¼š $$ \\begin{align} h_{\\theta }(x) \u0026 = \\mathbb{E}[y|x;\\theta] \\\\ \u0026 = \\mu \\\\ \u0026= \\eta \\\\ \u0026= \\theta^{\\mathbf{T}}{x} \\end{align} $$ ç¬¬ä¸€ä¸ªç­‰å·æ˜¯å› ä¸ºç¬¬äºŒä¸ªå‡è®¾ï¼Œç¬¬ä¸‰ä¸ªç­‰å·æ˜¯æ ¹æ®æŒ‡æ•°æ—çš„å®šä¹‰æ¥çš„ï¼Œè€Œç¬¬å››ä¸ªç­‰å·åˆ™æ˜¯ç¬¬ä¸‰ä¸ªå‡è®¾\né€»è¾‘å›å½’ é€»è¾‘å›å½’ä¸­$y \\in \\{0, 1\\}$ï¼Œè‡ªç„¶å°±æƒ³åˆ°äº†ä¼¯åŠªåˆ©åˆ†å¸ƒï¼Œå³$y|x;\\theta \\sim \\text{Bernoulli}(\\phi )$ï¼Œå…¶ä¸­$\\phi=1/1+ e^{-\\eta }$ï¼Œé‚£ä¹ˆï¼š\n$$ \\begin{align} h_{\\theta }(x) \u0026 = \\mathbb{E}[y|x;\\theta ] \\\\ \u0026 = \\phi \\\\ \u0026= \\frac{1}{1 + e^{-\\eta }} \\\\ \u0026= \\frac{1}{1 + e^{-\\theta^{\\mathbf{T}}x}} \\end{align} $$ æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œé‚£ä¹ˆå…³äºä¸ºä½•é€»è¾‘å›å½’ä¸­çš„å‡è®¾å‡½æ•°å–ä¸Šè¿°å½¢å¼ï¼Œåˆå¤šäº†ä¸€ç§è§£é‡Šï¼Œå³æ ¹æ®æŒ‡æ•°æ—åˆ†å¸ƒå’ŒGLMçš„å®šä¹‰è€Œæ¥\n$g(\\eta) = \\mathbb{E}[T(y);\\eta ]$è¢«ç§°ä¸ºå“åº”å‡½æ•°ï¼ˆcanonical response functionï¼‰ï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¸¸è¢«ç§°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œè€Œ$g^{-1}$è¢«ç§°ä½œä¸ºé“¾æ¥å‡½æ•°ï¼ˆcanonical link functionï¼‰ã€‚é‚£ä¹ˆï¼Œå¯¹äºé«˜æ–¯åˆ†å¸ƒè€Œè¨€ï¼Œå“åº”å‡½æ•°å°±æ˜¯å•ä½å‡½æ•°ï¼›è€Œå¯¹äºä¼¯åŠªåˆ©åˆ†å¸ƒè€Œè¨€ï¼Œå“åº”å‡½æ•°å³ä¸ºsigmoidå‡½æ•°ï¼ˆå¯¹äºä¸¤ä¸ªåè¯çš„å®šä¹‰ï¼Œä¸åŒçš„æ–‡çŒ®å¯èƒ½ç›¸åï¼‰\nsoftmaxå›å½’ æ„å»ºGLM ä¹‹å‰é€»è¾‘å›å½’ä¸­æ˜¯åªæœ‰ä¸¤ç±»ï¼Œå½“$y \\in \\{1, 2, \\dots, k\\}$ï¼Œå³ç°åœ¨æ˜¯$k$åˆ†ç±»ï¼Œåˆ†å¸ƒæ˜¯multinomial distributionï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ„å»ºGLMï¼š\nè§„å®š$\\phi_{i}$è§„å®šäº†è¾“å‡º$y_{i}$çš„æ¦‚ç‡ï¼Œé‚£ä¹ˆ$\\phi_{i}, \\dots, \\phi_{k-1}$å³æ˜¯æˆ‘ä»¬çš„å‚æ•°ï¼Œé‚£ä½ è‚¯å®šå¥½å¥‡ä¸ºä»€ä¹ˆ$\\phi_{k}$ä¸æ˜¯ï¼Œå› ä¸ºè¾“å‡ºæ‰€æœ‰ç±»çš„æ¦‚ç‡ä¹‹å’Œä¸º$1$ï¼Œå³$\\phi_{k}$å¯è¢«å…¶ä»–çš„æ¦‚ç‡è¡¨ç¤ºï¼š\n$$ \\phi_{k} = 1-\\sum_{i}^{k-1} \\phi_{i} $$ ä»¥å¾€çš„$T(y)=y$ï¼Œå¯¹äºå¤šåˆ†ç±»è€Œè¨€ï¼Œæˆ‘ä»¬é‡‡ç”¨ç‹¬çƒ­ç¼–ç ï¼ˆone-hotï¼‰ï¼Œå³ï¼š\n$$ T(1) = \\begin{bmatrix} 1 \\\\ 0 \\\\ \\vdots \\\\ 0 \\end{bmatrix}, T(2) = \\begin{bmatrix} 0 \\\\ 1 \\\\ \\vdots \\\\ 0 \\end{bmatrix}, \\dots ,T(k-1) = \\begin{bmatrix} 0 \\\\ 0 \\\\ \\vdots \\\\ 1 \\end{bmatrix}, T(k) = \\begin{bmatrix} 0 \\\\ 0 \\\\ \\vdots \\\\ 0 \\end{bmatrix} $$ æ³¨æ„$T(y) \\in \\mathbb{R}^{k-1}$ï¼Œå› ä¸º$T(k)$å®šä¹‰ä¸ºå…¨é›¶å‘é‡ï¼Œé‚£ä¹ˆå¦‚ä½•è¡¨ç¤º$T(y)$çš„ç¬¬$i$ä¸ªå…ƒç´ å‘¢ï¼Ÿ\n$$ (T(y))_{i} = \\mathbb{1}\\{y=i\\} $$\næ¥ä¸‹æ¥æ¥æ„å»ºGLMï¼Œå†™å‡ºå…¶æ¦‚ç‡å¯†åº¦è¡¨ç¤ºï¼Œæ³¨æ„ï¼šè¿™é‡Œå®¹æ˜“è¯¯ä»¥ä¸ºæ˜¯MLEä¸­çš„æ‰€æœ‰æ¦‚ç‡ç›¸ä¹˜ï¼Œç„¶è€Œå½“$y$å–ä¸€ä¸ªå…·ä½“å€¼æ—¶ï¼Œåªæœ‰ä¸€ä¸ªæŒ‡ç¤ºå‡½æ•°ä¸º$1$ï¼Œå…¶ä»–ä¸º$0$ï¼Œå³$\\phi_{i}^{0} = 1$\n$$ \\begin{align} p(y;\\phi ) \u0026 = \\phi^{\\mathbb{1}\\{y=1\\}}_{1} \\phi_{2}^{\\mathbb{1}\\{y=2\\}} \\dots \\phi^{\\mathbb{1}\\{y=k\\}}_{k} \\\\ \u0026 = \\phi^{\\mathbb{1}\\{y=1\\}}_{1} \\phi_{2}^{\\mathbb{1}\\{y=2\\}} \\dots \\phi^{1-\\sum_{i}^{k-1}\\mathbb{1}\\{y=i\\}}_{k} \\\\ \u0026= \\phi_{1}^{(T(y))_{1}} \\phi_{2}^{(T(y)_{2})} \\dots \\phi_{k}^{1-\\sum_{i}^{k-1}(T(y))_{i}} \\\\ \\end{align} $$ ç»§ç»­å˜å½¢æ¥è·Ÿå®šä¹‰åšæ¯”è¾ƒï¼š\n$$ \\begin{align} p(y; \\phi)\u0026= \\exp \\bigg((T(y))_{1}\\log \\phi_{1} + (T(y))_{2} \\log \\phi_{2} + \\dots +(1-\\sum_{i}^{k-1}(T(y))_{i})\\log \\phi_{k} \\bigg) \\\\ \u0026= \\exp \\bigg((T(y))_{1}\\log \\frac{\\phi_{1}}{\\phi_{k}} + (T(y))_{2}\\log \\frac{\\phi_{2}}{\\phi_{k}} + \\dots+ (T(y))_{k-1}\\log \\frac{\\phi_{k-1}}{\\phi_{k}} + \\log \\phi_{k}\\bigg) \\end{align} $$\né‚£ä¹ˆï¼š\n$$ \\eta = \\begin{bmatrix} \\log (\\phi_{1} / \\phi_{k}) \\\\ \\log (\\phi_{2} / \\phi_{k}) \\\\ \\vdots \\\\ \\log(\\phi_{k-1} / \\phi_{k}) \\end{bmatrix}, a(\\eta ) = -\\log(\\phi_{k}), b(y) =1 $$ é“¾æ¥å‡½æ•°å®¹æ˜“å‘ç°æ˜¯ï¼š\n$$ \\eta_{i} = \\log \\frac{\\phi_{i}}{\\phi_{k}} $$ æ¥ä¸‹æ¥æ±‚å“åº”å‡½æ•°ï¼š\n$$ \\begin{align} e^{\\eta_{i}} \u0026 = \\frac{\\phi_{i}}{\\phi_{k}} \\\\ \\phi_{k}e^{\\eta_{i}} \u0026 = \\phi_{i} \\\\ \\phi_{k}\\sum_{i}^{k} e^{\\eta_{i}} \u0026 = \\sum_{i}^{k} \\phi_{i} = 1 \\end{align} $$ é‚£ä¹ˆï¼š\n$$ \\phi_{k} = \\frac{1}{\\sum_{i}^{k} e^{\\eta_{i}}} $$ å°†$\\phi_{k}$ä»£å…¥ä¸Šå¼ï¼š\n$$ \\phi_{i} = \\frac{e^{\\eta_{i}}}{\\sum_{j=1}^{k} e^{\\eta_{j}}} $$ è¿™å°±æ˜¯æˆ‘ä»¬çš„æ¿€æ´»å‡½æ•°ï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­å¸¸è¢«ç§°ä¸ºã€Œsoftmaxã€å‡½æ•°ï¼Œæ¥ä¸‹æ¥ä¾¿å¯æ„å»ºGLMï¼š\n$$ \\begin{align} p(y=i|x;\\theta ) \u0026 = \\phi_{i} \\\\ \u0026= \\frac{e^{\\eta_{i}}}{\\sum_{j=1}^{k} e^{\\eta_{j}}} \\\\ \u0026= \\frac{e^{\\theta_{i}^{\\mathbf{T}}x}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x}} \\end{align} $$ å¤šåˆ†ç±»é—®é¢˜è¢«çœ‹ä½œæ˜¯é€»è¾‘å›å½’çš„æ¨å¹¿ç‰ˆï¼Œåˆè¢«ç§°ä¸ºã€Œsoftmax regressionã€ï¼Œæˆ‘ä»¬çš„å‡è®¾å‡½æ•°å¦‚ä¸‹ï¼š\n$$ \\begin{align} h_{\\theta }(x) \u0026 = \\mathbb{E}[T(y)|x;\\theta ] \\\\ \u0026= \\mathbb{E}\\left[\\begin{array}{c|} \\mathbb{1}\\{y=1\\} \\\\ \\mathbb{1}\\{y=2\\} \\\\ \\vdots \\\\ \\mathbb{1}\\{y=k-1\\} \\end{array} x;\\theta \\right] \\\\ \\end{align} $$\nåˆå› ä¸ºï¼š\n$$ \\mathbb{E}[(T(y))_{i}] = \\phi_{i} $$ ä¸ºå•¥ä¼šè¿™æ ·å‘¢ï¼Ÿå› ä¸ºå¯¹äº$(T(y))_{i}$åªæœ‰ä¸¤ä¸ªå¯èƒ½ï¼Œ$1$æˆ–$0$ï¼Œé‚£ä¹ˆå®ƒçš„æœŸæœ›æ˜¯ä¸æ˜¯ï¼š\n$$ \\mathbb{E}[(T(y))_{i}] = 1 \\cdot \\phi_{i} + 0 \\cdot (1-\\phi ) = \\phi_{i} $$\n$$ h_{\\theta }(x)= \\begin{bmatrix} \\phi_{1} \\\\ \\phi_{2} \\\\ \\vdots \\\\ \\phi_{k-1} \\end{bmatrix}= \\begin{bmatrix} \\frac{\\exp ({\\theta_{1}^{\\mathbf{T}}x)}}{\\sum_{j=1}^{k} \\exp(\\theta_{j}^{\\mathbf{T}}x)} \\\\ \\frac{\\exp ({\\theta_{2}^{\\mathbf{T}}x})}{\\sum_{j=1}^{k} \\exp(\\theta_{j}^{\\mathbf{T}}x)} \\\\ \\vdots \\\\ \\frac{\\exp ({\\theta_{k-1}^{\\mathbf{T}}x})}{\\sum_{j=1}^{k} \\exp(\\theta_{j}^{\\mathbf{T}}x)} \\end{bmatrix} $$ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„å‡è®¾å‡½æ•°éœ€è¦è¾“å‡ºæ¯ä¸ªç±»çš„æ¦‚ç‡ï¼Œå°½ç®¡åªæœ‰$k-1$ç±»ï¼Œ$\\phi_{k} = 1- \\sum_{i}^{k-1} \\phi_{i}$å¾—åˆ°\næ¥ä¸‹æ¥è¿›è¡Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡å¹¶å¯¹$\\ell(\\theta)$è¿›è¡ŒåŒ–ç®€ï¼š\n$$ \\begin{align} \\ell(\\theta ) \u0026 = \\sum_{i} \\log p(y^{(i)}|x^{(i)};\\theta ) \\\\ \u0026= \\sum_{i} \\log \\prod_{l=1}^{k} \\left( \\frac{e^{\\theta_{l}^{\\mathbf{T}}x^{(i)}}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} \\right)^{\\mathbb{1}\\{y^{(i)}=l\\}} \\\\ \u0026= \\sum_{i}^{m} \\sum_{l=1}^{k} \\log \\left( \\frac{e^{\\theta_{l}^{\\mathbf{T}}x^{(i)}}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} \\right)^{\\mathbb{1}\\{y^{(i)}=l\\}} \\\\ \u0026= \\sum_{i}^{m} \\sum_{l=1}^{k} {\\color{red}\\mathbb{1}\\{y^{(i)}=l\\}} \\log \\left( \\frac{e^{\\theta_{l}^{\\mathbf{T}}x^{(i)}}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} \\right) \\\\ \u0026= \\sum_{i}^{m}\\sum_{l=1}^{k} \\mathbb{1}\\{y^{(i)} = l\\} \\left( \\log e^{\\theta_{l}^{\\mathbf{T}}x^{(i)}}- \\log \\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}} \\right) \\\\ \u0026= \\sum_{i}^{m}\\sum_{l=1}^{k} \\mathbb{1}\\{y^{(i)} = l\\} \\left(\\theta_{l}^{\\mathbf{T}}x^{(i)}- \\log \\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}\\right) \\\\ \u0026= \\sum_{i}^{m}\\sum_{l=1}^{k} \\mathbb{1}\\{y^{(i)} = l\\} \\theta_{l}^{\\mathbf{T}}x^{(i)}-\\left( \\log \\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}\\underbrace{ \\sum_{l=1}^{k} \\mathbb{1}\\{y^{(i)} = l\\} }_{ 1 }\\right) \\\\ \u0026= \\sum_{i}^{m} \\bigg(\\sum_{l=1}^{k} \\mathbb{1}\\{y^{(i)} = l\\} \\theta_{l}^{\\mathbf{T}}x^{(i)} - \\log \\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}\\bigg) \\end{align} $$\nä¸Šè¿°åŒ–ç®€ä¸»è¦åˆ©ç”¨äº†æŒ‡ç¤ºå‡½æ•°çš„æ€§è´¨ä»¥åŠ$\\log$çš„è¿ç®—æ³•åˆ™ï¼ŒåŒæ—¶$\\theta \\in \\mathbb{R}^{k \\times n}$ï¼Œæˆ‘ä»¬åˆ©ç”¨å¸ƒå±€æ³•æ¥æ±‚ï¼š\n$$ \\begin{align} \\frac{ \\partial \\ell(\\theta ) }{ \\partial \\theta_{pq} } \u0026 = \\sum_{i}^{m} \\mathbb{1}\\{y^{(i)} = p\\} x^{(i)}_{q} - \\frac{1}{\\sum_{j=1}^{k}e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} e^{\\theta_{p}^{\\mathbf{T}}x^{(i)}}x^{(i)}_{q} \\\\ \u0026= \\sum_{i}^{m} \\left( \\mathbb{1}\\{y^{(i)} = p\\} - \\frac{e^{\\theta_{p}^{\\mathbf{T}}x^{(i)}}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} \\right)x^{(i)}_{q} \\end{align} $$ å› ä¸ºè¿™é‡Œæ˜¯æœ€å¤§åŒ–$\\ell(\\theta)$ï¼Œä½œä¸ºæŸå¤±å‡½æ•°è¿˜åº”åŠ ä¸ªè´Ÿå·ï¼Œè¿™æ ·æ‰æ˜¯æœ€å°ï¼Œå³\n$$ J(\\theta ) = -\\sum_{i} \\log \\prod_{l=1}^{k} \\left( \\frac{e^{\\theta_{l}^{\\mathbf{T}}x^{(i)}}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} \\right)^{\\mathbb{1}\\{y^{(i)}=l\\}} $$\nå¯¹åº”çš„å¾®åˆ†å¦‚ä¸‹ï¼š $$ \\frac{ \\partial J(\\theta ) }{ \\partial \\theta_{pq} } = \\sum_{i}^{m} \\left( \\frac{e^{\\theta_{p}^{\\mathbf{T}}x^{(i)}}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} - \\mathbb{1}\\{y^{(i)} = p\\} \\right)x^{(i)}_{q} $$\näº¤å‰ç†µ æˆ‘ä»¬å¸¸å¸¸ç§°å¤šåˆ†ç±»çš„æŸå¤±å«ã€Œäº¤å‰ç†µæŸå¤±ã€ï¼ˆcross entropy lossï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®GLMæ¨å¯¼çš„å¼å­å’Œäº¤å‰ç†µçš„è”ç³»æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\nè”æƒ³äº¤å‰ç†µçš„å®šä¹‰ï¼š\n$$ H(P, Q) = - \\mathbb{E}_{x \\sim P}[\\log Q(x)] $$ å³ä½¿å¾—æ¨¡å‹è¾“å‡ºçš„åˆ†å¸ƒå°½å¯èƒ½é è¿‘è®­ç»ƒé›†åŸæ¥çš„åˆ†å¸ƒï¼š\n$$ \\theta^{\\ast} = \\mathop{\\arg \\min}_{\\theta} -\\mathbb{E}_{x \\sim \\mathcal{D}}[\\log p_{model}(x)] $$ æˆ‘ä»¬æ¥ä¸‹æ¥å±•å¼€æœŸæœ›çš„è®¡ç®—ï¼š\n$$ -\\mathbb{E}_{x \\sim \\mathcal{D}}[\\log p_{model}(x)] = \\frac{1}{m}\\underbrace{ -\\sum_{i}^{m} \\log \\prod_{l=1}^{k} \\left( \\frac{e^{\\theta_{l}^{\\mathbf{T}}x^{(i)}}}{\\sum_{j=1}^{k} e^{\\theta_{j}^{\\mathbf{T}}x^{(i)}}} \\right)^{\\mathbb{1}\\{y^{(i)}=l\\}} }_{ J(\\theta) } $$ ä¸¤è€…å…¶å®å°±å·®ä¸€ä¸ªå¸¸æ•°ï¼Œæœ¬è´¨æ˜¯ä¸€æ ·çš„\nä»£ç å®ç°ä¹Ÿæ¯”è¾ƒè½»æ¾ï¼š\ndef CrossEntropy(y_pred, y_true): batch_size = y_pred.shape[0] y_pred = np.exp(y_pred) y_pred /= np.sum(y_pred, axis=1)[:, None] y_pred = np.take_along_axis(y_pred, y_true[:, None], axis=1) y_pred = np.log(y_pred) return -np.sum(y_pred) / batch_size ","wordCount":"3664","inLanguage":"en","datePublished":"2023-02-17T14:10:00+08:00","dateModified":"2023-02-17T14:10:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://yunpengtai.top/posts/generalized_linear_models/"},"publisher":{"@type":"Organization","name":"Tai's Blog","logo":{"@type":"ImageObject","url":"http://yunpengtai.top/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://yunpengtai.top accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://yunpengtai.top/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=http://yunpengtai.top/search/ title="æœç´¢ (Alt + /)" accesskey=/><span>æœç´¢</span></a></li><li><a href=http://yunpengtai.top/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=http://yunpengtai.top/friends/ title=å‹äºº><span>å‹äºº</span></a></li><li><a href=http://yunpengtai.top/about/ title=å…³äº><span>å…³äº</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://yunpengtai.top>Home</a>&nbsp;Â»&nbsp;<a href=http://yunpengtai.top/posts/>Posts</a></div><h1 class=post-title>Generalized Linear Models</h1><div class=post-meta><span title='2023-02-17 14:10:00 +0800 CST'>February 17, 2023</span>&nbsp;Â·&nbsp;3664 words</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%ae%9a%e4%b9%89 aria-label=å®šä¹‰>å®šä¹‰</a></li><li><a href=#%e4%be%8b%e5%ad%90 aria-label=ä¾‹å­>ä¾‹å­</a></li><li><a href=#%e6%80%a7%e8%b4%a8 aria-label=æ€§è´¨>æ€§è´¨</a></li><li><a href=#%e6%9e%84%e5%bb%baglm aria-label=æ„å»ºGLM>æ„å»ºGLM</a></li><li><a href=#glm%e4%be%8b%e5%ad%90 aria-label=GLMä¾‹å­>GLMä¾‹å­</a><ul><li><a href=#ols aria-label=OLS>OLS</a></li><li><a href=#%e9%80%bb%e8%be%91%e5%9b%9e%e5%bd%92 aria-label=é€»è¾‘å›å½’>é€»è¾‘å›å½’</a></li></ul></li><li><a href=#softmax%e5%9b%9e%e5%bd%92 aria-label=softmaxå›å½’>softmaxå›å½’</a><ul><li><a href=#%e6%9e%84%e5%bb%baglm-1 aria-label=æ„å»ºGLM>æ„å»ºGLM</a></li><li><a href=#%e4%ba%a4%e5%8f%89%e7%86%b5 aria-label=äº¤å‰ç†µ>äº¤å‰ç†µ</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=å®šä¹‰>å®šä¹‰<a hidden class=anchor aria-hidden=true href=#å®šä¹‰>#</a></h2><p>è‹¥ä¸€ä¸ªåˆ†å¸ƒèƒ½å¤Ÿä»¥ä¸‹è¿°æ–¹å¼è¿›è¡Œè¡¨ç¤ºï¼Œåˆ™ç§°ä¹‹ä¸ºæŒ‡æ•°æ—ï¼ˆ Exponential Familyï¼‰çš„ä¸€å‘˜</p><p><code>$$ \begin{equation} p(y; \eta ) = b(y)\exp(\eta^{\mathbf{T}}T(y) - a(\eta )) \end{equation} $$</code>
å…¶ä¸­<code>$\eta$</code>è¢«ç§°ä¸ºåˆ†å¸ƒçš„è‡ªç„¶å‚æ•°ï¼ˆnatural parameterï¼‰æˆ–æ ‡å‡†å‚æ•°ï¼ˆcanonical parameterï¼‰ï¼›è€Œ<code>$T(y)$</code>è¢«ç§°ä¸ºç»Ÿè®¡å……åˆ†é‡ï¼ˆsufficient statisticï¼‰ï¼Œé€šå¸¸è€Œè¨€ï¼š<code>$T(y) = y$</code>ï¼›<code>$a(\eta)$</code>æ˜¯å¯¹æ•°é…åˆ†å‡½æ•°ï¼ˆlog partitionï¼‰</p><h2 id=ä¾‹å­>ä¾‹å­<a hidden class=anchor aria-hidden=true href=#ä¾‹å­>#</a></h2><p>æ¥ä¸‹æ¥å±•ç¤ºä¸‹ä¼¯åŠªåˆ©åˆ†å¸ƒå’Œé«˜æ–¯åˆ†å¸ƒéƒ½æ˜¯æŒ‡æ•°æ—çš„ä¸€å‘˜</p><p>æœŸæœ›ä¸º<code>$\phi$</code>çš„ä¼¯åŠªåˆ©åˆ†å¸ƒä¸”<code>$y \in \{1, 0\}$</code>ï¼Œé‚£ä¹ˆï¼š</p><p><code>$$ p(y=1) = \phi; p(y=0) = 1-\phi $$</code></p><p>æ¥ç€è¿›è¡Œè½¬æ¢ï¼š</p><p><code>$$ \begin{align} p(y;\phi ) & = \phi^{y}(1-\phi )^{1-y} \\ &= \exp \bigg(\log(\phi^{y}(1-\phi )^{1-y})\bigg) \\ &= \exp(y\log \phi + (1-y)\log(1-\phi )) \\ &= \exp\left( \left( \log \frac{\phi }{1-\phi } \right)y + \log(1-\phi) \right) \end{align} $$</code></p><p>é‚£ä¹ˆå¯ä»¥å¯¹æ¯”ç€æŒ‡æ•°æ—çš„å®šä¹‰ï¼Œæ˜“å¾—<code>$b(y)=1$</code>ä»¥åŠï¼š</p><p><code>$$ \begin{align} \eta & = \log\left( \frac{\phi }{1-\phi } \right) \\ e^{\eta } & = \frac{\phi}{1-\phi } \\ {\color{red}e^{-\eta }} & = \frac{1-\phi}{\phi } = \frac{1}{\phi } - 1 \\ \phi & = \frac{1}{1+e^{-\eta }} \end{align} $$</code></p><p>å‘ç°å¾ˆæœ‰è¶£çš„ä¸€ç‚¹ï¼Œ<code>$\phi(\eta)$</code>ä¸å°±æ˜¯é€»è¾‘å›å½’ä¸­çš„sigmoidå‡½æ•°å˜›ï¼Œç»§ç»­æ¯”å¯¹å°†å…¶ä»–çš„å‚æ•°å†™å®Œæ•´ï¼š</p><p><code>$$ \begin{align} a(\eta ) & = -\log(1-\phi ) = -\log\left( 1-\frac{1}{1+e^{-\eta }} \right) \\ &= \log (1+e^{\eta }) \end{align} $$</code></p><p>æ¥ä¸‹æ¥è®¨è®ºé«˜æ–¯åˆ†å¸ƒï¼Œ<code>$\sigma^{2}$</code>å¯¹<code>$\theta, h_{\theta }(x)$</code>æ˜¯ä¸å½±å“çš„ï¼ˆç›¸å½“äºå¸¸æ•°ï¼‰ï¼Œä¸ºäº†ç®€åŒ–è¡¨ç¤ºï¼Œçº¦å®š<code>$\sigma^{2}=1$</code></p><p><code>$$ \begin{align} p(y;\mu ) & = \frac{1}{\sqrt{ 2\pi }}\exp\left( -\frac{(y-\mu )^{2}}{2} \right) \\ &= \underbrace{ \frac{1}{\sqrt{ 2\pi }} \exp\left( -\frac{y^{2}}{2} \right) }_{ b(y) }\exp\left( \mu y - \frac{\mu^{2}}{2} \right) \end{align} $$</code></p><p>æ¯”å¯¹å®šä¹‰ï¼Œå¯ä»¥å‘ç°ï¼š</p><p><code>$$ \eta = \mu; a(\eta ) = -\frac{\eta^{2}}{2} $$</code></p><h2 id=æ€§è´¨>æ€§è´¨<a hidden class=anchor aria-hidden=true href=#æ€§è´¨>#</a></h2><p><code>$$ p(y;\eta ) = b(y)\exp (\eta^{\mathbf{T}}T(y) - a(\eta)) $$</code></p><div class="notice notice-note"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165 8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><ol><li>æŒ‡æ•°æ—åˆ†å¸ƒçš„æœŸæœ›æ˜¯<code>$a(\eta)$</code>å¯¹<code>$\eta$</code>çš„ä¸€é˜¶å¾®åˆ†</li><li>æŒ‡æ•°æ—åˆ†å¸ƒçš„æ–¹å·®æ˜¯<code>$a(\eta)$</code>å¯¹<code>$\eta$</code>çš„äºŒé˜¶å¾®åˆ†</li><li>æŒ‡æ•°æ—åˆ†å¸ƒçš„NLL lossæ˜¯concaveçš„</li></ol></div><p>ä¸‹é¢æ¥è¯æ˜ä¸Šè¿°è§‚ç‚¹ï¼š</p><p><code>$$ \begin{align} \frac{ \partial }{ \partial \eta } p(y;\eta ) & = b(y) \exp(\eta^{\mathbf{T}}y - a(\eta )) \left( y - \frac{ \partial }{ \partial \eta }a(\eta ) \right) \\ &= yp(y;\eta ) - p(y;\eta ) \frac{ \partial }{ \partial \eta } a(\eta ) \end{align} $$</code></p><p>é‚£ä¹ˆï¼š</p><p><code>$$ y p(y;\eta ) = \frac{ \partial }{ \partial \eta } p(y;\eta ) + p(y;\eta ) \frac{ \partial }{ \partial \eta } a(\eta ) $$</code></p><p>åˆå› ä¸ºï¼š</p><p><code>$$ \begin{align} \mathbb{E}[Y;\eta ] & = \mathbb{E}[Y|X;\eta] \\ &= \int yp(y;\eta ) \,dy \\ &= \int \frac{ \partial }{ \partial \eta } p(y;\eta ) + p(y;\eta )\frac{ \partial }{ \partial \eta }a(\eta ) \, dy \\ &= \int \frac{ \partial }{ \partial \eta }p(y;\eta ) \, dy + \int p(y;\eta )\frac{ \partial }{ \partial \eta }a(\eta ) \, dy \\ &= \frac{ \partial }{ \partial \eta } \int p(y;\eta ) \, dy + \frac{ \partial }{ \partial \eta }a(\eta ) \int p(y;\eta ) \, dy \\ &= \frac{ \partial }{ \partial \eta } \cdot 1 + \frac{ \partial }{ \partial \eta } a(\eta ) \cdot 1 \\ &= 0 + \frac{ \partial }{ \partial \eta } a(\eta ) \\ &= \frac{ \partial }{ \partial \eta } a(\eta) \quad \blacksquare \end{align} $$</code></p><p>ä¸‹é¢æ¥è¯æ˜æ–¹å·®ï¼š</p><p><code>$$ \begin{align} \frac{ \partial^{2} }{ \partial \eta^{2} } p(y;\eta ) & = \frac{ \partial }{ \partial \eta } \bigg(yp(y;\eta ) - p(y;\eta ) \frac{ \partial }{ \partial \eta } a(\eta )\bigg) \\ &= y\frac{ \partial }{ \partial \eta }p(y;\eta ) - \frac{ \partial }{ \partial \eta } a(\eta )\frac{ \partial }{ \partial \eta }p(y;\eta ) - p(y;\eta )\frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta) \\ &= \frac{ \partial }{ \partial \eta }p(y;\eta ) \bigg(y - \frac{ \partial }{ \partial \eta }a(\eta ) \bigg) - p(y;\eta )\frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta ) \\ &= \bigg(yp(y;\eta ) - p(y;\eta ) \frac{ \partial }{ \partial \eta } a(\eta )\bigg)\bigg(y- \frac{ \partial }{ \partial \eta }a(\eta ) \bigg) - p(y;\eta ) \frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta ) \\ &= y^{2}p(y;\eta ) - 2yp(y;\eta ) \frac{ \partial }{ \partial \eta }a(\eta ) + p(y;\eta ) (\frac{ \partial }{ \partial \eta }a(\eta ) )^{2} - p(y;\eta ) \frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta ) \\ &= \bigg(y - \frac{ \partial }{ \partial \eta }a(\eta) \bigg)^{2} p(y;\eta ) -p(y;\eta ) \frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta) \end{align} $$</code></p><p>é‚£ä¹ˆï¼š</p><p><code>$$ \bigg(y - \frac{ \partial }{ \partial \eta }a(\eta) \bigg)^{2} p(y;\eta ) = \frac{ \partial^{2} }{ \partial \eta^{2} } p(y;\eta ) +p(y;\eta ) \frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta) $$</code></p><p>åˆå› ä¸ºï¼š</p><p><code>$$ \begin{align} \mathbb{V}[Y;\eta ] & = \mathbb{V}[Y|X;\eta] \\ &= \int \left( y - \frac{ \partial }{ \partial \eta } a(\eta ) \right)^{2} p(y;\eta)\, dy \\ &= \int \frac{ \partial^{2} }{ \partial \eta^{2} }p(y;\eta) + p(y;\eta ) \frac{ \partial^{2} }{ \partial \eta^{2} }a(\eta ) \, dy \\ &= \frac{ \partial^{2} }{ \partial \eta^{2} } \int p(y;\eta ) \, dy + \frac{ \partial ^{2} }{ \partial \eta^{2} } a(\eta )\int p(y;\eta ) \, dy \\ &= 0 + \frac{ \partial ^{2} }{ \partial \eta^{2} } a(\eta ) \\ &= \frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta ) \quad \blacksquare \end{align} $$</code></p><p>æ¥ä¸‹æ¥è¯æ˜NLL Lossæ˜¯å‡¸å‡½æ•°ï¼Œå…¶ä¸­<code>$a(\eta) \in \mathbb{R}^{m}, \mathbf{y} \in \mathbb{R}^{m}$</code>ï¼š</p><p><code>$$ \begin{align} J(\eta) & = -\log \sum_{i}^{m} p(y^{(i)};\eta_{i} ) \\ &= -\log \sum_{i}^{m} b(y^{(i)})\exp(\eta_{i} T(y^{(i)}) - a(\eta_{i})) \\ &= -\log \sum_{i}^{m} b(y^{(i)}) \exp( \eta_{i} y^{(i)}- a(\eta_{i})) \\ &= a(\eta) -\sum_{i}^{m} \log b(y^{(i)}) + \eta_{i}y^{(i)} \end{align} $$</code>
åŒæ—¶å› ä¸ºè‡ªèº«çš„åæ–¹å·®çŸ©é˜µæ˜¯ã€ŒåŠæ­£å®šã€çš„ï¼š</p><p><code>$$ \begin{align} \nabla_{\eta }^{2} J(\eta ) = \frac{ \partial^{2} }{ \partial \eta^{2} } a(\eta ) = \mathbb{V}[\mathbf{y};\eta ] \implies PSD\quad \blacksquare \end{align} $$</code></p><p>ç”±[[Critical Points#å¤šå˜é‡]]å¯çŸ¥ï¼Œå½“HessiançŸ©é˜µæ˜¯åŠæ­£å®šæ—¶ï¼ŒNLL Lossæ˜¯å‡¸å‡½æ•°ï¼Œæœ‰å±€éƒ¨æœ€å°ç‚¹</p><h2 id=æ„å»ºglm>æ„å»ºGLM<a hidden class=anchor aria-hidden=true href=#æ„å»ºglm>#</a></h2><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ ¹æ®æˆ‘ä»¬éœ€è¦é¢„æµ‹çš„å˜é‡æ¥é€‰å–åˆé€‚çš„åˆ†å¸ƒï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•æ„å»ºæ¨¡å‹å»é¢„æµ‹å®ƒå‘¢ï¼Ÿè¿™é‡Œæ¨¡å‹åˆè¢«ç§°ä¸ºå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼ˆGeneralized Linear Modelï¼‰ï¼Œè¦æ„å»ºGLMï¼Œéœ€è¦å…ˆè¿›è¡Œä¸€äº›å‡è®¾ï¼š</p><ol><li><code>$y|x; \theta \sim \mathrm{ExponentialFamily}(\eta )$</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»™å®š<code>$x, \theta$</code> æˆ‘ä»¬å¯ä»¥å¾—åˆ°<code>$y$</code>çš„åˆ†å¸ƒå°±æ˜¯å¸¦æœ‰å‚æ•°<code>$\eta$</code>çš„æŒ‡æ•°æ—åˆ†å¸ƒ</li><li>ç»™å®š<code>$x$</code>ï¼Œæˆ‘ä»¬éœ€è¦å»é¢„æµ‹<code>$y$</code>ï¼Œåœ¨æŒ‡æ•°æ—ä¸­ï¼Œ<code>$y=T(y)$</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¾—å»é¢„æµ‹æœŸæœ›ï¼Œå³å­¦å¾—çš„å‡è®¾<code>$h$</code>éœ€è¦å»é¢„æµ‹æœŸæœ›ï¼Œå³ï¼š<code>$h(x) = \mathbb{E}[y|x]$</code>ï¼Œè¿™ä¸ªåœ¨çº¿æ€§å›å½’å’Œé€»è¾‘å›å½’éƒ½æ˜¯æ»¡è¶³çš„ï¼Œä¸¾ä¸ªé€»è¾‘å›å½’çš„ä¾‹å­ï¼š
<code>$$ h_{\theta }(x) = p(y=1|x;\theta ) = 0 \cdot p(y=0|x;\theta) + 1 \cdot p(y=1|x;\theta) = \mathbb{E}[y|x;\theta ] $$</code></li><li>è‡ªç„¶å‚æ•°<code>$\eta$</code>ä¸<code>$x$</code>çš„è”ç³»æ˜¯çº¿æ€§çš„ï¼Œå³<code>$\eta = \theta^{\mathbf{T}}x$</code>ï¼Œè‹¥<code>$\eta \in \mathbb{R}^{n}$</code>ï¼Œåˆ™<code>$\eta_{i} = \theta_{i}^{\mathbf{T}}{x}$</code></li></ol><p>æ ¹æ®å˜é‡çš„ç‰¹ç‚¹æ¥é€‰æ‹©åˆé€‚çš„åˆ†å¸ƒï¼š</p><table><thead><tr><th style=text-align:center>Variable</th><th style=text-align:center>Distribution</th></tr></thead><tbody><tr><td style=text-align:center>Real Numbers <code>$\mathbb{R}$</code></td><td style=text-align:center>Gaussian</td></tr><tr><td style=text-align:center>Binary Classification</td><td style=text-align:center>Bernoulli</td></tr><tr><td style=text-align:center>Count</td><td style=text-align:center>Poisson</td></tr><tr><td style=text-align:center><code>$\mathbb{R}^{+}$</code></td><td style=text-align:center>Gamma, Exponential</td></tr><tr><td style=text-align:center>Distribution</td><td style=text-align:center>Beta, Dirichlet</td></tr></tbody></table><h2 id=glmä¾‹å­>GLMä¾‹å­<a hidden class=anchor aria-hidden=true href=#glmä¾‹å­>#</a></h2><p>æ¥ä¸‹æ¥ä¸¾ä¸€äº›GLMçš„ä¾‹å­</p><h3 id=ols>OLS<a hidden class=anchor aria-hidden=true href=#ols>#</a></h3><p>Ordinary Least Squaresï¼ˆçº¿æ€§å›å½’ï¼‰ä¸­çš„<code>$y|x;\theta \sim \mathcal{N}(\mu, \sigma^{2})$</code>ï¼Œå³æœä»é«˜æ–¯åˆ†å¸ƒï¼Œå…¶ä¸­<code>$\eta = \mu$</code>ï¼Œé‚£ä¹ˆï¼š
<code>$$ \begin{align} h_{\theta }(x) & = \mathbb{E}[y|x;\theta] \\ & = \mu \\ &= \eta \\ &= \theta^{\mathbf{T}}{x} \end{align} $$</code>
ç¬¬ä¸€ä¸ªç­‰å·æ˜¯å› ä¸ºç¬¬äºŒä¸ªå‡è®¾ï¼Œç¬¬ä¸‰ä¸ªç­‰å·æ˜¯æ ¹æ®æŒ‡æ•°æ—çš„å®šä¹‰æ¥çš„ï¼Œè€Œç¬¬å››ä¸ªç­‰å·åˆ™æ˜¯ç¬¬ä¸‰ä¸ªå‡è®¾</p><h3 id=é€»è¾‘å›å½’>é€»è¾‘å›å½’<a hidden class=anchor aria-hidden=true href=#é€»è¾‘å›å½’>#</a></h3><p>é€»è¾‘å›å½’ä¸­<code>$y \in \{0, 1\}$</code>ï¼Œè‡ªç„¶å°±æƒ³åˆ°äº†ä¼¯åŠªåˆ©åˆ†å¸ƒï¼Œå³<code>$y|x;\theta \sim \text{Bernoulli}(\phi )$</code>ï¼Œå…¶ä¸­<code>$\phi=1/1+ e^{-\eta }$</code>ï¼Œé‚£ä¹ˆï¼š</p><p><code>$$ \begin{align} h_{\theta }(x) & = \mathbb{E}[y|x;\theta ] \\ & = \phi \\ &= \frac{1}{1 + e^{-\eta }} \\ &= \frac{1}{1 + e^{-\theta^{\mathbf{T}}x}} \end{align} $$</code>
æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œé‚£ä¹ˆå…³äºä¸ºä½•é€»è¾‘å›å½’ä¸­çš„å‡è®¾å‡½æ•°å–ä¸Šè¿°å½¢å¼ï¼Œåˆå¤šäº†ä¸€ç§è§£é‡Šï¼Œå³æ ¹æ®æŒ‡æ•°æ—åˆ†å¸ƒå’ŒGLMçš„å®šä¹‰è€Œæ¥</p><p><code>$g(\eta) = \mathbb{E}[T(y);\eta ]$</code>è¢«ç§°ä¸ºå“åº”å‡½æ•°ï¼ˆcanonical response functionï¼‰ï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¸¸è¢«ç§°ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œè€Œ<code>$g^{-1}$</code>è¢«ç§°ä½œä¸ºé“¾æ¥å‡½æ•°ï¼ˆcanonical link functionï¼‰ã€‚é‚£ä¹ˆï¼Œå¯¹äºé«˜æ–¯åˆ†å¸ƒè€Œè¨€ï¼Œå“åº”å‡½æ•°å°±æ˜¯å•ä½å‡½æ•°ï¼›è€Œå¯¹äºä¼¯åŠªåˆ©åˆ†å¸ƒè€Œè¨€ï¼Œå“åº”å‡½æ•°å³ä¸ºsigmoidå‡½æ•°ï¼ˆå¯¹äºä¸¤ä¸ªåè¯çš„å®šä¹‰ï¼Œä¸åŒçš„æ–‡çŒ®å¯èƒ½ç›¸åï¼‰</p><h2 id=softmaxå›å½’>softmaxå›å½’<a hidden class=anchor aria-hidden=true href=#softmaxå›å½’>#</a></h2><h3 id=æ„å»ºglm-1>æ„å»ºGLM<a hidden class=anchor aria-hidden=true href=#æ„å»ºglm-1>#</a></h3><p>ä¹‹å‰é€»è¾‘å›å½’ä¸­æ˜¯åªæœ‰ä¸¤ç±»ï¼Œå½“<code>$y \in \{1, 2, \dots, k\}$</code>ï¼Œå³ç°åœ¨æ˜¯<code>$k$</code>åˆ†ç±»ï¼Œåˆ†å¸ƒæ˜¯multinomial distributionï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ„å»ºGLMï¼š</p><p>è§„å®š<code>$\phi_{i}$</code>è§„å®šäº†è¾“å‡º<code>$y_{i}$</code>çš„æ¦‚ç‡ï¼Œé‚£ä¹ˆ<code>$\phi_{i}, \dots, \phi_{k-1}$</code>å³æ˜¯æˆ‘ä»¬çš„å‚æ•°ï¼Œé‚£ä½ è‚¯å®šå¥½å¥‡ä¸ºä»€ä¹ˆ<code>$\phi_{k}$</code>ä¸æ˜¯ï¼Œå› ä¸ºè¾“å‡ºæ‰€æœ‰ç±»çš„æ¦‚ç‡ä¹‹å’Œä¸º<code>$1$</code>ï¼Œå³<code>$\phi_{k}$</code>å¯è¢«å…¶ä»–çš„æ¦‚ç‡è¡¨ç¤ºï¼š</p><p><code>$$ \phi_{k} = 1-\sum_{i}^{k-1} \phi_{i} $$</code>
ä»¥å¾€çš„<code>$T(y)=y$</code>ï¼Œå¯¹äºå¤šåˆ†ç±»è€Œè¨€ï¼Œæˆ‘ä»¬é‡‡ç”¨ç‹¬çƒ­ç¼–ç ï¼ˆone-hotï¼‰ï¼Œå³ï¼š</p><p><code>$$ T(1) = \begin{bmatrix} 1 \\ 0 \\ \vdots \\ 0 \end{bmatrix}, T(2) = \begin{bmatrix} 0 \\ 1 \\ \vdots \\ 0 \end{bmatrix}, \dots ,T(k-1) = \begin{bmatrix} 0 \\ 0 \\ \vdots \\ 1 \end{bmatrix}, T(k) = \begin{bmatrix} 0 \\ 0 \\ \vdots \\ 0 \end{bmatrix} $$</code>
æ³¨æ„<code>$T(y) \in \mathbb{R}^{k-1}$</code>ï¼Œå› ä¸º<code>$T(k)$</code>å®šä¹‰ä¸ºå…¨é›¶å‘é‡ï¼Œé‚£ä¹ˆå¦‚ä½•è¡¨ç¤º<code>$T(y)$</code>çš„ç¬¬<code>$i$</code>ä¸ªå…ƒç´ å‘¢ï¼Ÿ</p><p><code>$$ (T(y))_{i} = \mathbb{1}\{y=i\} $$</code></p><p>æ¥ä¸‹æ¥æ¥æ„å»ºGLMï¼Œå†™å‡ºå…¶æ¦‚ç‡å¯†åº¦è¡¨ç¤ºï¼Œæ³¨æ„ï¼šè¿™é‡Œå®¹æ˜“è¯¯ä»¥ä¸ºæ˜¯MLEä¸­çš„æ‰€æœ‰æ¦‚ç‡ç›¸ä¹˜ï¼Œç„¶è€Œå½“<code>$y$</code>å–ä¸€ä¸ªå…·ä½“å€¼æ—¶ï¼Œåªæœ‰ä¸€ä¸ªæŒ‡ç¤ºå‡½æ•°ä¸º<code>$1$</code>ï¼Œå…¶ä»–ä¸º<code>$0$</code>ï¼Œå³<code>$\phi_{i}^{0} = 1$</code></p><p><code>$$ \begin{align} p(y;\phi ) & = \phi^{\mathbb{1}\{y=1\}}_{1} \phi_{2}^{\mathbb{1}\{y=2\}} \dots \phi^{\mathbb{1}\{y=k\}}_{k} \\ & = \phi^{\mathbb{1}\{y=1\}}_{1} \phi_{2}^{\mathbb{1}\{y=2\}} \dots \phi^{1-\sum_{i}^{k-1}\mathbb{1}\{y=i\}}_{k} \\ &= \phi_{1}^{(T(y))_{1}} \phi_{2}^{(T(y)_{2})} \dots \phi_{k}^{1-\sum_{i}^{k-1}(T(y))_{i}} \\ \end{align} $$</code>
ç»§ç»­å˜å½¢æ¥è·Ÿå®šä¹‰åšæ¯”è¾ƒï¼š</p><p><code>$$ \begin{align} p(y; \phi)&= \exp \bigg((T(y))_{1}\log \phi_{1} + (T(y))_{2} \log \phi_{2} + \dots +(1-\sum_{i}^{k-1}(T(y))_{i})\log \phi_{k} \bigg) \\ &= \exp \bigg((T(y))_{1}\log \frac{\phi_{1}}{\phi_{k}} + (T(y))_{2}\log \frac{\phi_{2}}{\phi_{k}} + \dots+ (T(y))_{k-1}\log \frac{\phi_{k-1}}{\phi_{k}} + \log \phi_{k}\bigg) \end{align} $$</code></p><p>é‚£ä¹ˆï¼š</p><p><code>$$ \eta = \begin{bmatrix} \log (\phi_{1} / \phi_{k}) \\ \log (\phi_{2} / \phi_{k}) \\ \vdots \\ \log(\phi_{k-1} / \phi_{k}) \end{bmatrix}, a(\eta ) = -\log(\phi_{k}), b(y) =1 $$</code>
é“¾æ¥å‡½æ•°å®¹æ˜“å‘ç°æ˜¯ï¼š</p><p><code>$$ \eta_{i} = \log \frac{\phi_{i}}{\phi_{k}} $$</code>
æ¥ä¸‹æ¥æ±‚å“åº”å‡½æ•°ï¼š</p><p><code>$$ \begin{align} e^{\eta_{i}} & = \frac{\phi_{i}}{\phi_{k}} \\ \phi_{k}e^{\eta_{i}} & = \phi_{i} \\ \phi_{k}\sum_{i}^{k} e^{\eta_{i}} & = \sum_{i}^{k} \phi_{i} = 1 \end{align} $$</code>
é‚£ä¹ˆï¼š</p><p><code>$$ \phi_{k} = \frac{1}{\sum_{i}^{k} e^{\eta_{i}}} $$</code>
å°†<code>$\phi_{k}$</code>ä»£å…¥ä¸Šå¼ï¼š</p><p><code>$$ \phi_{i} = \frac{e^{\eta_{i}}}{\sum_{j=1}^{k} e^{\eta_{j}}} $$</code>
è¿™å°±æ˜¯æˆ‘ä»¬çš„æ¿€æ´»å‡½æ•°ï¼Œåœ¨æ·±åº¦å­¦ä¹ ä¸­å¸¸è¢«ç§°ä¸ºã€Œsoftmaxã€å‡½æ•°ï¼Œæ¥ä¸‹æ¥ä¾¿å¯æ„å»ºGLMï¼š</p><p><code>$$ \begin{align} p(y=i|x;\theta ) & = \phi_{i} \\ &= \frac{e^{\eta_{i}}}{\sum_{j=1}^{k} e^{\eta_{j}}} \\ &= \frac{e^{\theta_{i}^{\mathbf{T}}x}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x}} \end{align} $$</code>
å¤šåˆ†ç±»é—®é¢˜è¢«çœ‹ä½œæ˜¯é€»è¾‘å›å½’çš„æ¨å¹¿ç‰ˆï¼Œåˆè¢«ç§°ä¸ºã€Œsoftmax regressionã€ï¼Œæˆ‘ä»¬çš„å‡è®¾å‡½æ•°å¦‚ä¸‹ï¼š</p><p><code>$$ \begin{align} h_{\theta }(x) & = \mathbb{E}[T(y)|x;\theta ] \\ &= \mathbb{E}\left[\begin{array}{c|} \mathbb{1}\{y=1\} \\ \mathbb{1}\{y=2\} \\ \vdots \\ \mathbb{1}\{y=k-1\} \end{array} x;\theta \right] \\ \end{align} $$</code></p><p>åˆå› ä¸ºï¼š</p><p><code>$$ \mathbb{E}[(T(y))_{i}] = \phi_{i} $$</code>
ä¸ºå•¥ä¼šè¿™æ ·å‘¢ï¼Ÿå› ä¸ºå¯¹äº<code>$(T(y))_{i}$</code>åªæœ‰ä¸¤ä¸ªå¯èƒ½ï¼Œ<code>$1$</code>æˆ–<code>$0$</code>ï¼Œé‚£ä¹ˆå®ƒçš„æœŸæœ›æ˜¯ä¸æ˜¯ï¼š</p><p><code>$$ \mathbb{E}[(T(y))_{i}] = 1 \cdot \phi_{i} + 0 \cdot (1-\phi ) = \phi_{i} $$</code></p><p><code>$$ h_{\theta }(x)= \begin{bmatrix} \phi_{1} \\ \phi_{2} \\ \vdots \\ \phi_{k-1} \end{bmatrix}= \begin{bmatrix} \frac{\exp ({\theta_{1}^{\mathbf{T}}x)}}{\sum_{j=1}^{k} \exp(\theta_{j}^{\mathbf{T}}x)} \\ \frac{\exp ({\theta_{2}^{\mathbf{T}}x})}{\sum_{j=1}^{k} \exp(\theta_{j}^{\mathbf{T}}x)} \\ \vdots \\ \frac{\exp ({\theta_{k-1}^{\mathbf{T}}x})}{\sum_{j=1}^{k} \exp(\theta_{j}^{\mathbf{T}}x)} \end{bmatrix} $$</code>
ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„å‡è®¾å‡½æ•°éœ€è¦è¾“å‡ºæ¯ä¸ªç±»çš„æ¦‚ç‡ï¼Œå°½ç®¡åªæœ‰<code>$k-1$</code>ç±»ï¼Œ<code>$\phi_{k} = 1- \sum_{i}^{k-1} \phi_{i}$</code>å¾—åˆ°</p><p>æ¥ä¸‹æ¥è¿›è¡Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡å¹¶å¯¹<code>$\ell(\theta)$</code>è¿›è¡ŒåŒ–ç®€ï¼š</p><p><code>$$ \begin{align} \ell(\theta ) & = \sum_{i} \log p(y^{(i)}|x^{(i)};\theta ) \\ &= \sum_{i} \log \prod_{l=1}^{k} \left( \frac{e^{\theta_{l}^{\mathbf{T}}x^{(i)}}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} \right)^{\mathbb{1}\{y^{(i)}=l\}} \\ &= \sum_{i}^{m} \sum_{l=1}^{k} \log \left( \frac{e^{\theta_{l}^{\mathbf{T}}x^{(i)}}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} \right)^{\mathbb{1}\{y^{(i)}=l\}} \\ &= \sum_{i}^{m} \sum_{l=1}^{k} {\color{red}\mathbb{1}\{y^{(i)}=l\}} \log \left( \frac{e^{\theta_{l}^{\mathbf{T}}x^{(i)}}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} \right) \\ &= \sum_{i}^{m}\sum_{l=1}^{k} \mathbb{1}\{y^{(i)} = l\} \left( \log e^{\theta_{l}^{\mathbf{T}}x^{(i)}}- \log \sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}} \right) \\ &= \sum_{i}^{m}\sum_{l=1}^{k} \mathbb{1}\{y^{(i)} = l\} \left(\theta_{l}^{\mathbf{T}}x^{(i)}- \log \sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}\right) \\ &= \sum_{i}^{m}\sum_{l=1}^{k} \mathbb{1}\{y^{(i)} = l\} \theta_{l}^{\mathbf{T}}x^{(i)}-\left( \log \sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}\underbrace{ \sum_{l=1}^{k} \mathbb{1}\{y^{(i)} = l\} }_{ 1 }\right) \\ &= \sum_{i}^{m} \bigg(\sum_{l=1}^{k} \mathbb{1}\{y^{(i)} = l\} \theta_{l}^{\mathbf{T}}x^{(i)} - \log \sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}\bigg) \end{align} $$</code></p><p>ä¸Šè¿°åŒ–ç®€ä¸»è¦åˆ©ç”¨äº†æŒ‡ç¤ºå‡½æ•°çš„æ€§è´¨ä»¥åŠ<code>$\log$</code>çš„è¿ç®—æ³•åˆ™ï¼ŒåŒæ—¶<code>$\theta \in \mathbb{R}^{k \times n}$</code>ï¼Œæˆ‘ä»¬åˆ©ç”¨å¸ƒå±€æ³•æ¥æ±‚ï¼š</p><p><code>$$ \begin{align} \frac{ \partial \ell(\theta ) }{ \partial \theta_{pq} } & = \sum_{i}^{m} \mathbb{1}\{y^{(i)} = p\} x^{(i)}_{q} - \frac{1}{\sum_{j=1}^{k}e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} e^{\theta_{p}^{\mathbf{T}}x^{(i)}}x^{(i)}_{q} \\ &= \sum_{i}^{m} \left( \mathbb{1}\{y^{(i)} = p\} - \frac{e^{\theta_{p}^{\mathbf{T}}x^{(i)}}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} \right)x^{(i)}_{q} \end{align} $$</code>
å› ä¸ºè¿™é‡Œæ˜¯æœ€å¤§åŒ–<code>$\ell(\theta)$</code>ï¼Œä½œä¸ºæŸå¤±å‡½æ•°è¿˜åº”åŠ ä¸ªè´Ÿå·ï¼Œè¿™æ ·æ‰æ˜¯æœ€å°ï¼Œå³</p><p><code>$$ J(\theta ) = -\sum_{i} \log \prod_{l=1}^{k} \left( \frac{e^{\theta_{l}^{\mathbf{T}}x^{(i)}}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} \right)^{\mathbb{1}\{y^{(i)}=l\}} $$</code></p><p>å¯¹åº”çš„å¾®åˆ†å¦‚ä¸‹ï¼š
<code>$$ \frac{ \partial J(\theta ) }{ \partial \theta_{pq} } = \sum_{i}^{m} \left( \frac{e^{\theta_{p}^{\mathbf{T}}x^{(i)}}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} - \mathbb{1}\{y^{(i)} = p\} \right)x^{(i)}_{q} $$</code></p><h3 id=äº¤å‰ç†µ>äº¤å‰ç†µ<a hidden class=anchor aria-hidden=true href=#äº¤å‰ç†µ>#</a></h3><p>æˆ‘ä»¬å¸¸å¸¸ç§°å¤šåˆ†ç±»çš„æŸå¤±å«ã€Œäº¤å‰ç†µæŸå¤±ã€ï¼ˆcross entropy lossï¼‰ï¼Œé‚£ä¹ˆæ ¹æ®GLMæ¨å¯¼çš„å¼å­å’Œäº¤å‰ç†µçš„è”ç³»æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è”æƒ³äº¤å‰ç†µçš„å®šä¹‰ï¼š</p><p><code>$$ H(P, Q) = - \mathbb{E}_{x \sim P}[\log Q(x)] $$</code>
å³ä½¿å¾—æ¨¡å‹è¾“å‡ºçš„åˆ†å¸ƒå°½å¯èƒ½é è¿‘è®­ç»ƒé›†åŸæ¥çš„åˆ†å¸ƒï¼š</p><p><code>$$ \theta^{\ast} = \mathop{\arg \min}_{\theta} -\mathbb{E}_{x \sim \mathcal{D}}[\log p_{model}(x)] $$</code>
æˆ‘ä»¬æ¥ä¸‹æ¥å±•å¼€æœŸæœ›çš„è®¡ç®—ï¼š</p><p><code>$$ -\mathbb{E}_{x \sim \mathcal{D}}[\log p_{model}(x)] = \frac{1}{m}\underbrace{ -\sum_{i}^{m} \log \prod_{l=1}^{k} \left( \frac{e^{\theta_{l}^{\mathbf{T}}x^{(i)}}}{\sum_{j=1}^{k} e^{\theta_{j}^{\mathbf{T}}x^{(i)}}} \right)^{\mathbb{1}\{y^{(i)}=l\}} }_{ J(\theta) } $$</code>
ä¸¤è€…å…¶å®å°±å·®ä¸€ä¸ªå¸¸æ•°ï¼Œæœ¬è´¨æ˜¯ä¸€æ ·çš„</p><p>ä»£ç å®ç°ä¹Ÿæ¯”è¾ƒè½»æ¾ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>CrossEntropy</span><span class=p>(</span><span class=n>y_pred</span><span class=p>,</span> <span class=n>y_true</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_size</span> <span class=o>=</span> <span class=n>y_pred</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span> <span class=o>/=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>y_pred</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)[:,</span> <span class=kc>None</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>take_along_axis</span><span class=p>(</span><span class=n>y_pred</span><span class=p>,</span> <span class=n>y_true</span><span class=p>[:,</span> <span class=kc>None</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>y_pred</span><span class=p>)</span> <span class=o>/</span> <span class=n>batch_size</span>
</span></span></code></pre></div></div><div style="margin-top:2em;padding:1em;border:0 solid;border-radius:10px;background-color:var(--code-bg)"><h3>ğŸ±å¦‚æœæ‚¨æƒ³è¦å¼•ç”¨ï¼Œè¯·è€ƒè™‘å¦‚ä¸‹æ ¼å¼ï¼š</h3><div style=padding-top:.5em>å°è¿é¹. (Feb. 17, 2023). ã€ŠGeneralized Linear Modelsã€‹[Blog
post]. Retrieved from http://yunpengtai.top/posts/generalized_linear_models/</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>@online{blog-eb846a0d78cd11d250e409ccfe0d7cc7,
</span></span><span class=line><span class=cl>        title=Generalized Linear Models,
</span></span><span class=line><span class=cl>        author={Yunpeng Tai},
</span></span><span class=line><span class=cl>        year=2023,
</span></span><span class=line><span class=cl>        month=Feb,
</span></span><span class=line><span class=cl>        url=http://yunpengtai.top/posts/generalized_linear_models/,
</span></span><span class=line><span class=cl>        note=yunpengtai.typ@gmail.com,
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><div style=padding-bottom:.4em>è‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²åï¼ˆ<a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-SA 4.0ï¼‰</a></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://yunpengtai.top/tags/linear-models/>linear models</a></li></ul><nav class=paginav><a class=prev href=http://yunpengtai.top/posts/determinantal_point_process/><span class=title>Â« Prev</span><br><span>Determinantal Point Process</span></a>
<a class=next href=http://yunpengtai.top/posts/dive_in_distributed_training/><span class=title>Next Â»</span><br><span>Diving in distributed training in PyTorch</span></a></nav></footer><link rel=stylesheet href=https://unpkg.com/katex@0.16.7/dist/katex.min.css><script src=https://unpkg.com/katex@0.16.7/dist/katex.min.js></script>
<link href=https://cdn.jsdelivr.net/gh/sherlcok314159/artalk-assets@main/artalk.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/artalk/2.8.6/Artalk.js></script>
<script src=https://unpkg.com/@artalk/plugin-katex@latest/dist/artalk-plugin-katex.js></script><div id=Comments></div><script>const artalk=Artalk.init({el:"#Comments",pageKey:"",pageTitle:"Generalized Linear Models",server:"https://comment.yunpengtai.top",site:"Tai's Blog"});artalk.on("list-loaded",e=>{artalk.setDarkMode(localStorage.getItem("pref-theme")=="dark")})</script></article></main><footer class=footer><span>&copy; 2024 <a href=http://yunpengtai.top>Tai's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/sherlcok314159/MyPaperMod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("/js/pangu.min.js",function(){pangu.spacingPage()})</script><script>(function(){var e,t,n,s=document.getElementsByTagName("code");for(n=0;n<s.length;){if(t=s[n],t.parentNode.tagName!=="PRE"&&t.childElementCount===0&&(e=t.textContent,/^\$[^$]/.test(e)&&/[^$]\$$/.test(e)&&(e=e.replace(/^\$/,"\\(").replace(/\$$/,"\\)"),t.textContent=e),/^\\\((.|\s)+\\\)$/.test(e)||/^\\\[(.|\s)+\\\]$/.test(e)||/^\$(.|\s)+\$$/.test(e)||/^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(e))){t.outerHTML=t.innerHTML;continue}n++}})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Going Deeper into Back-Propagation | Tai's Blog</title><meta name=keywords content="back-propagation"><meta name=description content="1. Gradient descent optimization Gradient-based methods make use of the gradient information to adjust the parameters. Among them, gradient descent can be the simplest. Gradient descent makes the parameters to walk a small step in the direction of the negative gradient.
$$ \boldsymbol{w}^{\tau + 1} = \boldsymbol{w}^{\tau} - \eta \nabla_{\boldsymbol{w}^{\tau}} E \tag{1.1} $$
where $\eta, \tau, E$ label learning rate ($\eta > 0$), the iteration step and the loss function. Wait!"><meta name=author content><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="eAKh7zszsOtNde1wyq_sUo95ZPH4zTTJhR-_ol4VWDs"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://yunpengtai.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://yunpengtai.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://yunpengtai.top/favicon-32x32.png><link rel=apple-touch-icon href=http://yunpengtai.top/apple-touch-icon.png><link rel=mask-icon href=http://yunpengtai.top/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>MathJax={loader:{load:["[tex]/boldsymbol"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"all",packages:{"[+]":["boldsymbol"]}}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml-full.js integrity="sha256-kbAFUDxdHwlYv01zraGjvjNZayxKtdoiJ38bDTFJtaQ=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3CX2RWEDY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y3CX2RWEDY",{anonymize_ip:!1})}</script><meta property="og:title" content="Going Deeper into Back-Propagation"><meta property="og:description" content="1. Gradient descent optimization Gradient-based methods make use of the gradient information to adjust the parameters. Among them, gradient descent can be the simplest. Gradient descent makes the parameters to walk a small step in the direction of the negative gradient.
$$ \boldsymbol{w}^{\tau + 1} = \boldsymbol{w}^{\tau} - \eta \nabla_{\boldsymbol{w}^{\tau}} E \tag{1.1} $$
where $\eta, \tau, E$ label learning rate ($\eta > 0$), the iteration step and the loss function. Wait!"><meta property="og:type" content="article"><meta property="og:url" content="http://yunpengtai.top/posts/deep-back-propagation/"><meta property="og:image" content="http://yunpengtai.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-07T18:10:00+08:00"><meta property="article:modified_time" content="2022-09-07T18:10:00+08:00"><meta property="og:site_name" content="Tai's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://yunpengtai.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Going Deeper into Back-Propagation"><meta name=twitter:description content="1. Gradient descent optimization Gradient-based methods make use of the gradient information to adjust the parameters. Among them, gradient descent can be the simplest. Gradient descent makes the parameters to walk a small step in the direction of the negative gradient.
$$ \boldsymbol{w}^{\tau + 1} = \boldsymbol{w}^{\tau} - \eta \nabla_{\boldsymbol{w}^{\tau}} E \tag{1.1} $$
where $\eta, \tau, E$ label learning rate ($\eta > 0$), the iteration step and the loss function. Wait!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"http://yunpengtai.top/posts/"},{"@type":"ListItem","position":3,"name":"Going Deeper into Back-Propagation","item":"http://yunpengtai.top/posts/deep-back-propagation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Going Deeper into Back-Propagation","name":"Going Deeper into Back-Propagation","description":"1. Gradient descent optimization Gradient-based methods make use of the gradient information to adjust the parameters. Among them, gradient descent can be the simplest. Gradient descent makes the parameters to walk a small step in the direction of the negative gradient.\n$$ \\boldsymbol{w}^{\\tau + 1} = \\boldsymbol{w}^{\\tau} - \\eta \\nabla_{\\boldsymbol{w}^{\\tau}} E \\tag{1.1} $$\nwhere $\\eta, \\tau, E$ label learning rate ($\\eta \u0026gt; 0$), the iteration step and the loss function. Wait!","keywords":["back-propagation"],"articleBody":"1. Gradient descent optimization Gradient-based methods make use of the gradient information to adjust the parameters. Among them, gradient descent can be the simplest. Gradient descent makes the parameters to walk a small step in the direction of the negative gradient.\n$$ \\boldsymbol{w}^{\\tau + 1} = \\boldsymbol{w}^{\\tau} - \\eta \\nabla_{\\boldsymbol{w}^{\\tau}} E \\tag{1.1} $$\nwhere $\\eta, \\tau, E$ label learning rate ($\\eta \u003e 0$), the iteration step and the loss function. Wait! But why is the negative gradient?\n2. Why negative gradient The function increases the most sharply by following the direction of the gradient.\nThe below is an example. The three-dimensional plane is $z = F(x, y)$. The black point is on the plane. You can try to move the point to see how the arrow changes. Interestingly, the arrow always points to the direction which leads to the biggest increase of the function value. Note that when you move one step, the gradient just changes. Thus if you still want to increase the function value in the most sharp way, another computation is needed.\nThe starting point of the arrow is the mapping of the black point to the $xoy$ plane. The arrow is parallel to the gradient.\nLet us use another graph to better understand what the mapping means. The left graph is contour plot while the right is the plane. The red point is just the mapping of the black point to $xoy$ plane. The blue arrow is just the direction of the gradient. And you can move the point to feel about it.\nThat is the intuitive way to feel about the gradient. Furthermore, we can just try to prove it. from the question in stackexchange\nConsider a Taylor Expansion:\n$$ \\begin{aligned} F(\\boldsymbol{r_0} + \\boldsymbol{r}) \u0026= F(\\boldsymbol{r_0}) + \\nabla_{r_0}F \\cdot \\boldsymbol{r} \\\\ \u0026= F(\\boldsymbol{r_0}) + \\|\\nabla_{r_0}F\\|\\cdot \\|\\boldsymbol{r}\\| \\cdot \\cos \\theta \\end{aligned}\\tag{2.1} $$\nWhen you decide to move a small step, the two magnitudes are certain. If $\\theta=0$, you can maximize the function value (i.e. in the direction of gradient).\nThus if we want to minimize our loss function, we need to go in the opposite direction of the gradient. That is why we need a negative gradient. Also, note that Taylor Expansion only applies to small $\\Delta x$ which requires $\\eta$ to be small (e.g. $2 \\times 10^{-5}, 5 \\times 10^{-5}$).\nBut how to compute the gradients needs a powerful technique: back-propagation.\n3. Definition of back-propagation Back-propagation allows information from the cost to then flow backwards through the network, in order to compute the gradients used to adjust the parameters.\nBack-propagation can be new to the novices, but it does exist in the life widely. For instance, the loss can be your teacher’s attitude towards you. If you fail in one examination, your teacher can be disappointed with you. Then, he can tell your parents about your failure. Your parents then ask you to work harder to win the examination.\nYour parents can be seen as hidden units in the neural network, and you are the parameter of the network. Your teacher’s bad attitude towards your failure can ask you to make adjustments: working harder. Similarly, the loss can require the parameters to make adjustments via gradients.\n4. Chain Rule Suppose $z = f(y), y = g(x) \\implies z = (f \\circ g)(x)$, how to calculate the derivative of $z$ with respect to $x$? The chain rule of calculus is used to compute the derivatives of functions formed by composing other functions whose derivatives are known.\n$$ \\frac{dz}{dx} = \\frac{dz}{dy} \\frac{dy}{dx} \\tag{4.1} $$\n5. Case Study Fully-connected layer\nLet’s first see an important example. In fully connected layers, one input neuron sends information (i.e., multiplied by weights) to every output neuron. Denote $w_{ji}$ as the weight from $x_i$ to $y_j$. Then for every output neuron (e.g., $y_j$), it accepts the information sent by every input neuron:\n$$ y_{j}= \\sum\\limits_{i} w_{ji} x_{i} \\tag{5.1} $$\nThen the partial derivative of $y_j$ with respect to $x_i$:\n$$ \\frac{\\partial y_j}{\\partial x_{i}}= w_{ji} \\tag{5.2} $$\nLet’s see another example which is represented by the computational graph below. Bishop-Pattern-Recognition-and-Machine-Learning-2006\nAnother example\nAnd we can perform a forward propagation according to the computational graph.\n$$ \\begin{align} h_{j} \u0026= \\sum\\limits_{i} w_{ji}^{(1)} x_{i} \\tag{5.3} \\\\ z_{j} \u0026= f(h_{j}) \\tag{5.4} \\\\ y_{k} \u0026= \\sum\\limits_{j}w_{kj}^{(2)} z_{j} \\tag{5.5} \\end{align} $$\nwhere\n$$ f(h) = \\tanh(h) = \\frac{e^h - e^{-h}}{e^h + e^{-h}} \\tag{5.6} $$\nA useful feature of this activation is that its derivative can be expressed in a particularly simple form:\n$$ f'(h) = 1 - f(h)^2 \\tag{5.7} $$\nThe error function can be mean squared errors:\n$$ E(\\boldsymbol{w}) = \\frac{1}{2} \\sum\\limits_{k}(y_{k}- \\hat{y}_k)^2 \\tag{5.8} $$\nIf we want to update the parameters, we need first to compute the partial derivative of $E(\\boldsymbol{w})$ with respect to them.\n$$ \\frac{\\partial E(\\mathbf{w})}{\\partial w_{kj}^{(2)}} = \\frac{\\partial E(\\mathbf{w})}{\\partial y_{k}} \\frac{\\partial y_k}{\\partial w_{kj}^{(2)}} = (y_{k}- \\hat{y}_k)z_j \\tag{5.9} $$\n$$ \\begin{align} \\frac{\\partial E(\\boldsymbol{w})}{\\partial w_{ji}^{(1)}} \u0026= \\frac{\\partial E(\\boldsymbol{w})}{\\partial h_{j}}\\frac{\\partial h_j}{\\partial w_{ji}^{(1)}} = \\left(\\frac{\\partial E(\\boldsymbol{w})}{\\partial z_{j}} \\frac{\\partial z_j}{\\partial h_j}\\right)x_{i} \\tag{5.10}\\\\ \\end{align} $$\n$$ \\frac{\\partial E(\\boldsymbol{w})}{\\partial z_j} = \\sum\\limits_k\\frac{\\partial E(\\boldsymbol{w})}{\\partial y_k}\\frac{\\partial y_k}{\\partial z_j}= \\sum\\limits_k (y_k- \\hat{y}_k) w_{kj}^{(2)} \\tag{5.11} $$\n$\\text{Remark.}$ $z_j$ can send information to all the output neurons (e.g., $y_k$), thus we need to sum over all the derivatives with respect to $z_j$.\nSubstituting $\\text{(4.11)}$ into $\\text{(4.10)}$ we obtain\n$$ \\frac{\\partial E(\\boldsymbol{w})}{\\partial w_{ji}^{(1)}} = (1 - z_j^2)x_{i} \\sum\\limits_{k} (y_{k} - \\hat{y}_{k}) w_{kj}^{(2)} \\tag{5.12} $$\n6. Interpretation Recall the Taylor approximation of the two variables function:\n$$ f(x, y) = f(x_0, y_0) + f_x (x- x_0) + f_y(y-y_0) \\tag{6.1} $$\n$\\text{Remark.}$ $(x, y)$ needs to be close to $(x_0, y_0)$, otherwise the approximation can fail.\nWe can transform $\\text{(5.1)}$ into $\\text{(5.3)}$:\n$$ \\begin{align} f(x,y) - f(x_{0},y_0) \u0026= f_x (x- x_0) + f_y(y-y_0) \\tag{6.2}\\\\\\ \\implies \\Delta f \u0026= f_x \\Delta x + f_y \\Delta y\\tag{6.3} \\end{align} $$ If we apply $\\text{(5.3)}$ in the example above, we can obtain\n$$ \\Delta E(\\boldsymbol{w}) = \\nabla_{\\boldsymbol{w}}E(\\boldsymbol{w}) \\Delta \\boldsymbol{w} \\tag{6.4} $$\nFrom another perspective, a small change in the parameters will propagate into a small change in object function by getting multiplied by the gradient.\nTo summarize, back-propagation allows information to flow backwards through the network. This information can tell the model a small change in one particular parameter can result in what change in the object function. And gradient descent can use this information to adjust the parameters for optimizing the object function.\n","wordCount":"1051","inLanguage":"en","datePublished":"2022-09-07T18:10:00+08:00","dateModified":"2022-09-07T18:10:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://yunpengtai.top/posts/deep-back-propagation/"},"publisher":{"@type":"Organization","name":"Tai's Blog","logo":{"@type":"ImageObject","url":"http://yunpengtai.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://yunpengtai.top accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://yunpengtai.top/archives/ title=归档><span>归档</span></a></li><li><a href=http://yunpengtai.top/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=http://yunpengtai.top/categories/%E6%8A%98%E8%85%BE title=折腾><span>折腾</span></a></li><li><a href=http://yunpengtai.top/tags/ title=标签><span>标签</span></a></li><li><a href=http://yunpengtai.top/friends/ title=友人><span>友人</span></a></li><li><a href=http://yunpengtai.top/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://yunpengtai.top>Home</a>&nbsp;»&nbsp;<a href=http://yunpengtai.top/posts/>Posts</a></div><h1 class=post-title>Going Deeper into Back-Propagation</h1><div class=post-meta><span title='2022-09-07 18:10:00 +0800 CST'>September 7, 2022</span>&nbsp;·&nbsp;1051 words</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-gradient-descent-optimization aria-label="1. Gradient descent optimization">1. Gradient descent optimization</a></li><li><a href=#2-why-negative-gradient aria-label="2. Why negative gradient">2. Why negative gradient</a></li><li><a href=#3-definition-of-back-propagation aria-label="3. Definition of back-propagation">3. Definition of back-propagation</a></li><li><a href=#4-chain-rule aria-label="4. Chain Rule">4. Chain Rule</a></li><li><a href=#5-case-study aria-label="5. Case Study">5. Case Study</a></li><li><a href=#6-interpretation aria-label="6. Interpretation">6. Interpretation</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h3 id=1-gradient-descent-optimization>1. Gradient descent optimization<a hidden class=anchor aria-hidden=true href=#1-gradient-descent-optimization>#</a></h3><p>Gradient-based methods make use of the gradient information to adjust the parameters. Among them, gradient descent can be the simplest. Gradient descent makes the parameters to walk a small step in the direction of the negative gradient.</p><p><code>$$ \boldsymbol{w}^{\tau + 1} = \boldsymbol{w}^{\tau} - \eta \nabla_{\boldsymbol{w}^{\tau}} E \tag{1.1} $$</code></p><p>where <code>$\eta, \tau, E$</code> label learning rate (<code>$\eta > 0$</code>), the iteration step and the loss function. Wait! But why is the negative gradient?</p><h3 id=2-why-negative-gradient>2. Why negative gradient<a hidden class=anchor aria-hidden=true href=#2-why-negative-gradient>#</a></h3><div class="notice notice-note"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zm-248 50a46 46 0 100 92 46 46 0 000-92zm-44-165 8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p>The function increases the most sharply by following the direction of the gradient.</p></div><p>The below is an example. The three-dimensional plane is <code>$z = F(x, y)$</code>. The black point is on the plane. You can try to move the point to see how the arrow changes. Interestingly, the arrow always points to the direction which leads to the <strong>biggest</strong> increase of the function value. Note that when you move one step, the gradient just changes. Thus if you still want to increase the function value in the most sharp way, another computation is needed.</p><div class="notice notice-tip"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zM227 387l184-184c7-6 7-16 0-22l-22-23c-7-6-17-6-23 0L216 308l-70-70c-6-6-16-6-23 0l-22 23c-7 6-7 16 0 22l104 104c6 7 16 7 22 0z"/></svg></div><p>The starting point of the arrow is the mapping of the black point to the $xoy$ plane. The arrow is parallel to the gradient.</p></div><div class=iframe_container><iframe scrolling=no title="Directional derivatives and Gradient" src=https://www.geogebra.org/material/iframe/id/wd5mrudh/width/800/height/600/border/888888/rc/false/ai/false/sdz/false/smb/false/stb/false/stbh/false/ld/false/sri/false/at/auto width=600px height=460px></iframe></div><p>Let us use another graph to better understand what the mapping means. The left graph is contour plot while the right is the plane. The red point is just the mapping of the black point to <code>$xoy$</code> plane. The blue arrow is just the direction of the gradient. And you can move the point to feel about it.</p><div class=iframe_container><iframe scrolling=no title="Directional derivatives and Gradient" src=https://www.geogebra.org/material/iframe/id/vpt37qtt/width/788/height/520/border/888888/sfsb/true/smb/false/stb/false/stbh/false/ai/false/asb/false/sri/false/rc/false/ld/false/sdz/true/ctl/false width=600px height=460px></iframe></div><p>That is the <strong>intuitive</strong> way to feel about the gradient. Furthermore, we can just try to prove it.
<span class=sidenote-number><small class=sidenote>from the question in <a href=https://math.stackexchange.com/questions/223252/why-is-gradient-the-direction-of-steepest-ascent>stackexchange</a></small></span></p><p>Consider a Taylor Expansion:</p><p><code>$$ \begin{aligned} F(\boldsymbol{r_0} + \boldsymbol{r}) &= F(\boldsymbol{r_0}) + \nabla_{r_0}F \cdot \boldsymbol{r} \\ &= F(\boldsymbol{r_0}) + \|\nabla_{r_0}F\|\cdot \|\boldsymbol{r}\| \cdot \cos \theta \end{aligned}\tag{2.1} $$</code></p><p>When you decide to move a small step, the two magnitudes are certain. If <code>$\theta=0$</code>, you can maximize the function value (i.e. <strong>in the direction of gradient</strong>).</p><p>Thus if we want to minimize our loss function, we need to go in the opposite direction of the gradient. That is why we need a negative gradient. Also, note that Taylor Expansion only applies to small <code>$\Delta x$</code> which requires <code>$\eta$</code> to be small (e.g. <code>$2 \times 10^{-5}, 5 \times 10^{-5}$</code>).</p><p>But how to compute the gradients needs a powerful technique: back-propagation.</p><h3 id=3-definition-of-back-propagation>3. Definition of back-propagation<a hidden class=anchor aria-hidden=true href=#3-definition-of-back-propagation>#</a></h3><div class="notice notice-tip"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zM227 387l184-184c7-6 7-16 0-22l-22-23c-7-6-17-6-23 0L216 308l-70-70c-6-6-16-6-23 0l-22 23c-7 6-7 16 0 22l104 104c6 7 16 7 22 0z"/></svg></div><p>Back-propagation allows information from the cost to then flow backwards through the network, in order to compute the gradients used to adjust the parameters.</p></div><p>Back-propagation can be new to the novices, but it does exist in the life widely. For instance, the loss can be your teacher&rsquo;s attitude towards you. If you fail in one examination, your teacher can be disappointed with you. Then, he can tell your parents about your failure. Your parents then ask you to work harder to win the examination.</p><p>Your parents can be seen as <strong>hidden units</strong> in the neural network, and you are the parameter of the network. Your teacher&rsquo;s bad attitude towards your failure can ask you to make adjustments: working harder. Similarly, the loss can require the parameters to make adjustments via gradients.</p><h3 id=4-chain-rule>4. Chain Rule<a hidden class=anchor aria-hidden=true href=#4-chain-rule>#</a></h3><p>Suppose <code>$z = f(y), y = g(x) \implies z = (f \circ g)(x)$</code>, how to calculate the derivative of <code>$z$</code> with respect to <code>$x$</code>? The chain rule of calculus is used to compute the derivatives of functions formed by composing other functions whose derivatives are known.</p><p><code>$$ \frac{dz}{dx} = \frac{dz}{dy} \frac{dy}{dx} \tag{4.1} $$</code></p><h3 id=5-case-study>5. Case Study<a hidden class=anchor aria-hidden=true href=#5-case-study>#</a></h3><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script>
<a data-fancybox=gallery href=https://s2.loli.net/2022/09/07/iTFg9de8RyfJavm.png><figure class=align-center><img loading=lazy src=https://s2.loli.net/2022/09/07/iTFg9de8RyfJavm.png#center alt="Fully-connected layer" width=300px height=150px><figcaption><p>Fully-connected layer</p></figcaption></figure></a><p>Let&rsquo;s first see an important example. In fully connected layers, one input neuron sends information (i.e., multiplied by weights) to every output neuron. Denote <code>$w_{ji}$</code> as the weight from <code>$x_i$</code> to <code>$y_j$</code>. Then for every output neuron (e.g., <code>$y_j$</code>), it accepts the information sent by every input neuron:</p><p><code>$$ y_{j}= \sum\limits_{i} w_{ji} x_{i} \tag{5.1} $$</code></p><p>Then the partial derivative of $y_j$ with respect to $x_i$:</p><p><code>$$ \frac{\partial y_j}{\partial x_{i}}= w_{ji} \tag{5.2} $$</code></p><p>Let&rsquo;s see another example which is represented by the computational graph below.
<span class=sidenote-number><small class=sidenote>Bishop-Pattern-Recognition-and-Machine-Learning-2006</small></span></p><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script>
<a data-fancybox=gallery href=https://s2.loli.net/2022/09/07/QOJYtIw6BNmsc2i.png><figure class=align-center><img loading=lazy src=https://s2.loli.net/2022/09/07/QOJYtIw6BNmsc2i.png#center alt="Another example" width=300px height=200px><figcaption><p>Another example</p></figcaption></figure></a><p>And we can perform a forward propagation according to the computational graph.</p><p><code>$$ \begin{align} h_{j} &= \sum\limits_{i} w_{ji}^{(1)} x_{i} \tag{5.3} \\ z_{j} &= f(h_{j}) \tag{5.4} \\ y_{k} &= \sum\limits_{j}w_{kj}^{(2)} z_{j} \tag{5.5} \end{align} $$</code></p><p>where</p><p><code>$$ f(h) = \tanh(h) = \frac{e^h - e^{-h}}{e^h + e^{-h}} \tag{5.6} $$</code></p><p>A useful feature of this activation is that its derivative can be expressed in a particularly simple form:</p><p><code>$$ f'(h) = 1 - f(h)^2 \tag{5.7} $$</code></p><p>The error function can be mean squared errors:</p><p><code>$$ E(\boldsymbol{w}) = \frac{1}{2} \sum\limits_{k}(y_{k}- \hat{y}_k)^2 \tag{5.8} $$</code></p><p>If we want to update the parameters, we need first to compute the partial derivative of <code>$E(\boldsymbol{w})$</code> with respect to them.</p><p><code>$$ \frac{\partial E(\mathbf{w})}{\partial w_{kj}^{(2)}} = \frac{\partial E(\mathbf{w})}{\partial y_{k}} \frac{\partial y_k}{\partial w_{kj}^{(2)}} = (y_{k}- \hat{y}_k)z_j \tag{5.9} $$</code></p><p><code>$$ \begin{align} \frac{\partial E(\boldsymbol{w})}{\partial w_{ji}^{(1)}} &= \frac{\partial E(\boldsymbol{w})}{\partial h_{j}}\frac{\partial h_j}{\partial w_{ji}^{(1)}} = \left(\frac{\partial E(\boldsymbol{w})}{\partial z_{j}} \frac{\partial z_j}{\partial h_j}\right)x_{i} \tag{5.10}\\ \end{align} $$</code></p><p><code>$$ \frac{\partial E(\boldsymbol{w})}{\partial z_j} = \sum\limits_k\frac{\partial E(\boldsymbol{w})}{\partial y_k}\frac{\partial y_k}{\partial z_j}= \sum\limits_k (y_k- \hat{y}_k) w_{kj}^{(2)} \tag{5.11} $$</code></p><p><code>$\text{Remark.}$</code> <code>$z_j$</code> can send information to all the output neurons (e.g., <code>$y_k$</code>), thus we need to sum over all the derivatives with respect to <code>$z_j$</code>.</p><p>Substituting <code>$\text{(4.11)}$</code> into <code>$\text{(4.10)}$</code> we obtain</p><p><code>$$ \frac{\partial E(\boldsymbol{w})}{\partial w_{ji}^{(1)}} = (1 - z_j^2)x_{i} \sum\limits_{k} (y_{k} - \hat{y}_{k}) w_{kj}^{(2)} \tag{5.12} $$</code></p><h3 id=6-interpretation>6. Interpretation<a hidden class=anchor aria-hidden=true href=#6-interpretation>#</a></h3><p>Recall the Taylor approximation of the two variables function:</p><p><code>$$ f(x, y) = f(x_0, y_0) + f_x (x- x_0) + f_y(y-y_0) \tag{6.1} $$</code></p><p><code>$\text{Remark.}$</code> <code>$(x, y)$</code> needs to be close to <code>$(x_0, y_0)$</code>, otherwise the approximation can fail.</p><p>We can transform <code>$\text{(5.1)}$</code> into <code>$\text{(5.3)}$</code>:</p><p><code>$$ \begin{align} f(x,y) - f(x_{0},y_0) &= f_x (x- x_0) + f_y(y-y_0) \tag{6.2}\\\ \implies \Delta f &= f_x \Delta x + f_y \Delta y\tag{6.3} \end{align} $$</code>
If we apply <code>$\text{(5.3)}$</code> in the example above, we can obtain</p><p><code>$$ \Delta E(\boldsymbol{w}) = \nabla_{\boldsymbol{w}}E(\boldsymbol{w}) \Delta \boldsymbol{w} \tag{6.4} $$</code></p><p>From another perspective, a small change in the parameters will propagate into a small change in object function by getting multiplied by the gradient.</p><div class="notice notice-tip"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 512 512"><path d="M504 256A248 248 0 118 256a248 248 0 01496 0zM227 387l184-184c7-6 7-16 0-22l-22-23c-7-6-17-6-23 0L216 308l-70-70c-6-6-16-6-23 0l-22 23c-7 6-7 16 0 22l104 104c6 7 16 7 22 0z"/></svg></div><p>To summarize, back-propagation allows information to flow backwards through the network. This information can tell the model a small change in one particular parameter can result in what change in the object function. And gradient descent can use this information to adjust the parameters for optimizing the object function.</p></div></div><div style="margin-top:2em;padding:1em;border:0 solid;border-radius:10px;background-color:var(--code-bg)"><h3>🐱如果您想要引用，请考虑如下格式：</h3><div style=padding-top:.5em>台运鹏. (Sep. 7, 2022). 《Going Deeper into Back-Propagation》[Blog
post]. Retrieved from http://yunpengtai.top/posts/deep-back-propagation/</div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>@online{blog-50cfcdc7b4f5927c13e5c3c096f2c40f,
</span></span><span class=line><span class=cl>        title={Going Deeper into Back-Propagation},
</span></span><span class=line><span class=cl>        author={Yunpeng Tai},
</span></span><span class=line><span class=cl>        year={2022},
</span></span><span class=line><span class=cl>        month={Sep},
</span></span><span class=line><span class=cl>        note={http://yunpengtai.top/posts/deep-back-propagation/},
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><div style=padding-bottom:.4em>自由转载-非商用-非衍生-保持署名（<a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-SA 4.0）</a></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://yunpengtai.top/tags/back-propagation/>back-propagation</a></li></ul><nav class=paginav><a class=prev href=http://yunpengtai.top/posts/dive-in-distributed-training/><span class=title>« Prev</span><br><span>Diving in distributed training in PyTorch</span></a>
<a class=next href=http://yunpengtai.top/posts/tips-for-training-nn/><span class=title>Next »</span><br><span>Tips for Training Neural Networks</span></a></nav></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/artalk@2.8.6/dist/Artalk.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/@artalk/plugin-katex@0.2.4/dist/artalk-plugin-katex.min.js></script><div id=Comments></div><script>const savedTheme=localStorage.getItem("pref-theme");let darkMode="auto";savedTheme!==null&&(darkMode=savedTheme==="dark");const artalk=Artalk.init({el:"#Comments",pageKey:"",pageTitle:"Going Deeper into Back-Propagation",server:"https://comment.yunpengtai.top",site:"Tai's Blog",darkMode,versionCheck:!1});document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?artalk.setDarkMode(!1):artalk.setDarkMode(!0)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=http://yunpengtai.top>Tai's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/sherlcok314159/MyPaperMod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("/js/pangu.min.js",function(){pangu.spacingPage()})</script><script>(function(){var e,t,n,s=document.getElementsByTagName("code");for(n=0;n<s.length;){if(t=s[n],t.parentNode.tagName!=="PRE"&&t.childElementCount===0&&(e=t.textContent,/^\$[^$]/.test(e)&&/[^$]\$$/.test(e)&&(e=e.replace(/^\$/,"\\(").replace(/\$$/,"\\)"),t.textContent=e),/^\\\((.|\s)+\\\)$/.test(e)||/^\\\[(.|\s)+\\\]$/.test(e)||/^\$(.|\s)+\$$/.test(e)||/^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(e))){t.outerHTML=t.innerHTML;continue}n++}})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>